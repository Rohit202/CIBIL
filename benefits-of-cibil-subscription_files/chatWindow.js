window.koreBotChat=function(){return function(e){var t,a,n,o,s,i,l,r,c,d,m,p=requireKr("/KoreBot.js").instance(),g={message:"Message...",connecting:"Connecting...",reconnecting:"Reconnecting..."},u={},f=/<script\b[^>]*>([\s\S]*?)/gm,h={},v=[],y=0,b="",I="",M=[],D=!1,C="",w=!1,x=!1,k=!1,T="",A="",L=0,N=!1,z=!1,_=window.navigator,E="content-type=audio/x-raw,+layout=(string)interleaved,+rate=(int)16000,+format=(string)S16LE,+channels=(int)1",S="../libs/recorderWorker.js",O=250,j=3e4,B=!1,R=null,H=null,U=null,P="",$=!1,Y=!1,Z=!1,G={},W={},F=["m4a","amr","aac","wav","mp3","mp4","mov","3gp","flv","png","jpg","jpeg","gif","bmp","csv","txt","json","pdf","doc","dot","docx","docm","dotx","dotm","xls","xlt","xlm","xlsx","xlsm","xltx","xltm","xlsb","xla","xlam","xll","xlw","ppt","pot","pps","pptx","pptm","potx","potm","ppam","ppsx","ppsm","sldx","sldm","zip","rar","tar","wpd","wps","rtf","msg","dat","sdf","vcf","xml","3ds","3dm","max","obj","ai","eps","ps","svg","indd","pct","accdb","db","dbf","mdb","pdb","sql","apk","cgi","cfm","csr","css","htm","html","jsp","php","xhtml","rss","fnt","fon","otf","ttf","cab","cur","dll","dmp","drv","7z","cbr","deb","gz","pkg","rpm","zipx","bak","avi","m4v","mpg","rm","swf","vob","wmv","3gp2","3g2","asf","asx","srt","wma","mid","aif","iff","m3u","mpa","ra","aiff","tiff"];G.CHUNK_SIZE=1048576;var Q={audio:["m4a","amr","wav","aac","mp3"],video:["mp4","mov","3gp","flv"],image:["png","jpg","jpeg"],file:{limit:{size:26214400,msg:"Please limit the individual file upload size to 25 MB or lower"}},determineFileType:function(e){return e=e.toLowerCase(),Q.image.indexOf(e)>-1?"image":Q.video.indexOf(e)>-1?"video":Q.audio.indexOf(e)>-1?"audio":"attachment"}},V={net:{}};window.PieChartCount=0,window.barchartCount=0,window.linechartCount=0;var K,q=[],J={};window.chartColors=["#75b0fe","#f78083","#99ed9e","#fde296","#26344a","#5f6bf7","#b3bac8","#99a1fd","#9cebf9","#f7c7f4"];var X=0;function ee(e){var t;return e&&(t=e.isNotAllowedHTMLTags()),t&&!t.isValid&&(e=e.escapeHTML()),e}String.prototype.isNotAllowedHTMLTags=function(){var t=document.createElement("div");t.innerHTML=this;var a={isValid:!0,key:""};try{return(e(t).find("script").length||e(t).find("video").length||e(t).find("audio").length)&&(a.isValid=!1),e(t).find("link").length&&-1!==e(t).find("link").attr("href").indexOf("script")&&(f.test(e(t).find("link").attr("href"))?a.isValid=!1:a.isValid=!0),e(t).find("a").length&&-1!==e(t).find("a").attr("href").indexOf("script")&&(f.test(e(t).find("a").attr("href"))?a.isValid=!1:a.isValid=!0),e(t).find("img").length&&-1!==e(t).find("img").attr("src").indexOf("script")&&(f.test(e(t).find("img").attr("href"))?a.isValid=!1:a.isValid=!0),e(t).find("object").length&&(a.isValid=!1),a}catch(e){return a}},String.prototype.escapeHTML=function(){var e={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return(""+this).replace(/[<>"']/g,function(t){return e[t]})},String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"g"),t)};var te={nl2br:function(e,t){return t&&(e=window.emojione.shortnameToImage(e)),e=e.replace(/(?:\r\n|\r|\n)/g,"<br />")},br2nl:function(e){return e=e.replace(/<br \/>/g,"\n")},formatAMPM:function(e){var t=e.getHours(),a=e.getMinutes(),n=e.getSeconds(),o=t>=12?"pm":"am",s=(t=(t%=12)||12)+":"+(a=a<10?"0"+a:a)+":"+n+" "+o;return s},formatDate:function(e){var t=new Date(e);if(isNaN(t.getTime())){var a=(new Date).getTime();t=new Date(a)}return t.toDateString()+" at "+te.formatAMPM(t)},convertMDtoHTML:function(t,a){var n={},o={};o.date=new RegExp(/\\d\(\s*(.{10})\s*(?:,\s*["'](.+?)["']\s*)?\)/g),o.time=new RegExp(/\\t\(\s*(.{8}\.\d{0,3})\s*\)/g),o.datetime=new RegExp(/\\(d|dt|t)\(\s*([-0-9]{10}[T][0-9:.]{12})([z]|[Z]|[+-]\d{4})[\s]*,[\s]*["']([a-zA-Z\W]+)["']\s*\)/g),o.num=new RegExp(/\\#\(\s*(\d*.\d*)\s*\)/g),o.curr=new RegExp(/\\\$\((\d*.\d*)[,](\s*[\"\']\s*\w{3}\s*[\"\']\s*)\)|\\\$\((\d*.\d*)[,](\s*\w{3}\s*)\)/g);var s={SPECIAL_CHARS:/[\=\`\~\!@#\$\%\^&\*\(\)_\-\+\{\}\:"\[\];\',\.\/<>\?\|\\]+/,EMAIL:/^[-a-z0-9~!$%^&*_=+}{\']+(\.[-a-z0-9~!$%^&*_=+}{\']+)*@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,255})+$/i,MENTION:/(^|\s|\\n|")@([^\s]*)(?:[\s]\[([^\]]*)\])?["]?/gi,HASHTAG:/(^|\s|\\n)#(\S+)/g,NEWLINE:/\n/g},i=/((?:http\:\/\/|https\:\/\/|www\.)+\S*\.(?:(?:\.\S)*[^\,\s\.])*\/?)/gi,l=/\[([^\]]+)\](|\s)\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\)?/g,r=t||"",c={};c.sd=new RegExp(/^(d{1})[^d]|[^d](d{1})[^d]/g),c.dd=new RegExp(/^(d{2})[^d]|[^d](d{2})[^d]/g),c.fy=new RegExp(/(y{4})|y{2}/g);var d=Object.keys(o);function m(e,t){for(var a,n=[];null!==(a=e.exec(t));){var o={};if(o.index=a.index,o.matchexp=a[0],a.length>1)for(var s=1;s<a.length;s++){var i="matchval"+s.toString();o[i]=a[s]}n.push(o)}return n}function p(e){return e.toUpperCase()}for(var g=0;g<d.length;g++){var u;switch(d[g]){case"date":var f=r,h=m(o.date,f);if(h.length)for(u=0;u<h.length;u++){var v=new Date(h[u].matchval1).toLocaleDateString();v=" "+v.toString()+" ",r=r.replace(h[u].matchexp.toString(),v)}break;case"time":var y=r,b=m(o.time,y);if(b.length)for(u=0;u<b.length;u++){var I=new Date(b[u].matchval1).toLocaleTimeString();I=" "+I.toString()+" ",r=r.replace(b[u].matchexp.toString(),I)}break;case"datetime":var M=r,D=m(o.datetime,M);if(D.length)for(u=0;u<D.length;u++){for(var C="",w=Object.keys(D[u]).length-2,x=2;x<w;x++){var k="matchval"+x.toString();C+=D[u][k]}var T="matchval"+w.toString(),A=D[u][T];A=(A=(A=A.replace(c.fy,p)).replace(c.dd,p)).replace(c.sd,p);var L=moment(C).format(A);L=" "+L.toString()+" ",r=r.replace(D[u].matchexp.toString(),L)}break;case"num":var N=r,z=m(o.num,N);if(z.length)for(u=0;u<z.length;u++){var _=Number(z[u].matchval1).toLocaleString();_=" "+_.toString()+" ",r=r.replace(z[u].matchexp.toString(),_)}break;case"curr":var E=r,S=m(o.curr,E),O=window.navigator.language||window.navigator.browserLanguage,j=new RegExp(/\w{3}/);if(S.length)for(u=0;u<S.length;u++){var B,R={style:"currency"};S[u].matchval2&&(B=j.exec(S[u].matchval2)),R.currency=B[0].toString();var H=Number(S[u].matchval1).toLocaleString(O,R);H=S[u].matchval1.toString()===H.toString()?" "+H.toString()+" "+R.currency:" "+H.toString()+" ",r=r.replace(S[u].matchexp.toString(),H)}}}function U(e,t,a,o){var s,i=o.replace(l,"[]");if(s=i,["onclick","onmouse","onblur","onscroll","onStart"].forEach(function(e){var t=new RegExp(e,"ig");s=s.replace(t,"")}),-1!==(i=s).indexOf(e)){var r=t.indexOf("http")<0?"http://"+e:e;if(target="target='underscoreblank'",n){var c="korerandom://"+Object.keys(n).length;n[c]=r,r=c}return"<span class='isLink'><a undefined href=\""+r+'">'+e+"</a></span>"}return e}s.NEWLINE;try{r=decodeURIComponent(r)}catch(e){r=r||""}var P,$="";if("user"===a)r=r.replace(/onerror=/gi,"abc-error="),P=document.createElement("div"),$=($=r.replace(/“/g,'"').replace(/”/g,'"')).replace(/</g,"&lt;").replace(/>/g,"&gt;"),P.innerHTML=ee($),r=e(P).find("a").attr("href")?$:$.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(i,U);else if((P=document.createElement("div")).innerHTML=ee(r),e(P).find("a").attr("href"))for(var Y=r.match(/<a[^>]*>([^<]+)<\/a>/g),Z=0;Z<Y.length;Z++){var G=document.createElement("div"),W=Y[Z];G.innerHTML=Y[Z],(W.indexOf("href='mailto:")>-1||W.indexOf('href="mailto:')>-1)&&(W=W.split("\n").join("%0A"));var F="korerandom://"+Object.keys(n).length;G.innerHTML=W;var Q=G.getElementsByTagName("a");Q&&Q[0]&&Q[0].href&&(n[F]=Q[0].href,Q[0].href=F),e(G).find("a").attr("target","underscoreblank"),r=r.replace(Y[Z],G.innerHTML)}else r=P.innerHTML.replace(i,U);r=te.checkMarkdowns(r,n);var V=Object.keys(n);return V&&V.length&&V.forEach(function(e){r=r.replace(e,function(){return n[e]})}),r=(r=r.replaceAll('target="underscoreblank"','target="_blank"')).replaceAll("target='underscoreblank'",'target="_blank"'),"user"===a&&(r=r.replace(/abc-error=/gi,"onerror=")),te.nl2br(r,!0)},checkMarkdowns:function(e,t){if(""===e)return e;for(var a=e.split(/\r?\n/),n=0;n<a.length;n++){var o,s=!1;0===a[n].indexOf("#h6")||0===a[n].indexOf("#H6")?(a[n]="<h6>"+a[n].substring(3)+"</h6>",s=!0):0===a[n].indexOf("#h5")||0===a[n].indexOf("#H5")?(a[n]="<h5>"+a[n].substring(3)+"</h5>",s=!0):0===a[n].indexOf("#h4")||0===a[n].indexOf("#H4")?(a[n]="<h4>"+a[n].substring(3)+"</h4>",s=!0):0===a[n].indexOf("#h3")||0===a[n].indexOf("#H3")?(a[n]="<h3>"+a[n].substring(3)+"</h3>",s=!0):0===a[n].indexOf("#h2")||0===a[n].indexOf("#H2")?(a[n]="<h2>"+a[n].substring(3)+"</h2>",s=!0):0===a[n].indexOf("#h1")||0===a[n].indexOf("#H1")?(a[n]="<h1>"+a[n].substring(3)+"</h1>",s=!0):0===a[n].length?(a[n]="\r\n",s=!0):0===a[n].indexOf("*")?(C=a[n].split("*").length-1,0===(C=Number(C))||!(!C||C%2)||(a[n]="\r\n&#9679; "+a[n].substring(1),s=!0)):0===a[n].indexOf(">>")?(a[n]='<p class="indent">'+a[n].substring(2)+"</p>",s=!0):0===a[n].indexOf("&gt;&gt;")?(a[n]='<p class="indent">'+a[n].substring(8)+"</p>",s=!0):0!==a[n].indexOf("---")&&0!==a[n].indexOf("___")||(a[n]="<hr/>"+a[n].substring(3),s=!0),-1===a[n].indexOf(" ![")&&(a[n]=a[n].replace("!["," !["));var i=a[n].match(/\!\[([^\]]+)\](|\s)+\(([^\)])+\)/g);if(i&&i.length>0)for(o=0;o<i.length;o++){var l=i[o].substring(2,i[o].indexOf("]")),r=i[o].substring(i[o].indexOf("]")+1).trim(),c=r.substring(1,r.indexOf(")"));if(t){var d="korerandom://"+Object.keys(t).length;t[d]=c,c=d}c='<img src="'+c+'" alt="'+l+'">';for(var m=a[n].split(" "),p=0;p<m.length;p++)m[p]===i[o]&&(m[p]=c);a[n]=m.join(" "),a[n]=a[n].replace(i[o],c)}var g=a[n].match(/\[([^\]]+)\](|\s)\((?:[^)(]+|\((?:[^)(]+|\([^)(]*\))*\))*\)/g);if(g&&g.length>0)for(o=0;o<g.length;o++){var u=g[o].substring(1,g[o].indexOf("]")),r=g[o].substring(g[o].indexOf("]")+1).trim(),f=r.substring(1,r.lastIndexOf(")"));if(f=f.replace(/\\n/g,"%0A"),t){var d="korerandom://"+Object.keys(t).length;t[d]=f,f=d}f='<span class="isLink"><a href="'+f+'" target="_blank">'+te.checkMarkdowns(u)+"</a></span>",a[n]=a[n].replace(g[o],f)}var h=a[n].match(/\*\S([^*]*?)\*/g);if(h&&h.length>0)for(o=0;o<h.length;o++){var v=h[o];v="<b>"+(v=v.substring(1,v.length-1)).trim()+"</b>",a[n]=a[n].replace(h[o],v)}var y=a[n].match(/\~\S([^*]*?)\S\~/g);if(y&&y.length>0)for(o=0;o<y.length;o++){var b=y[o];0!==a[n].indexOf(b)&&" "!==a[n][a[n].indexOf(b)-1]&&-1===a[n].indexOf(b)||(b='<i class="markdownItalic">'+(b=b.substring(1,b.length-1))+"</i>",a[n]=a[n].replace(y[o],b))}var y=a[n].match(/\_\S([^*]*?)\S\_/g);if(y&&y.length>0)for(o=0;o<y.length;o++){var b=y[o];0!==a[n].indexOf(b)&&" "!==a[n][a[n].indexOf(b)-1]&&-1===a[n].indexOf(b)||(b='<i class="markdownItalic">'+(b=b.substring(1,b.length-1))+"</i>",a[n]=a[n].replace(y[o],b))}var y=a[n].match(/\~\S([^*]*?)\S\~/g);if(y&&y.length>0)for(o=0;o<y.length;o++){var b=y[o];0!==a[n].indexOf(b)&&" "!==a[n][a[n].indexOf(b)-1]&&-1===a[n].indexOf(b)||(b='<i class="markdownItalic">'+(b=b.substring(1,b.length-1))+"</i>",a[n]=a[n].replace(y[o],b))}var I=a[n].match(/\`\`\`\S([^*]*?)\S\`\`\`/g),M=a[n].match(/\'\'\'\S([^*]*?)\S\'\'\'/g);if(I&&I.length>0){for(o=0;o<I.length;o++){var D=I[o];D="<pre>"+(D=D.substring(3,D.length-3))+"</pre>",a[n]=a[n].replace(I[o],D)}s=!0}if(M&&M.length>0){for(o=0;o<M.length;o++){var D=M[o];D="<pre>"+(D=D.substring(3,D.length-3))+"</pre>",a[n]=a[n].replace(M[o],D)}s=!0}!s&&n>0&&(a[n]="\r\n"+a[n])}var C;return e=a.join("")}};function ae(e){x=!1,e.botOptions.test=!1,this.config={chatTitle:"Kore.ai Bot Chat",container:"body",allowIframe:!1,botOptions:e.botOptions},n=e.botOptions.koreAPIUrl,b=e.botOptions.bearer,T=e.botOptions.koreSpeechAPIUrl,e.botOptions.ttsSocketUrl,C=e.botOptions.userIdentity,e.botOptions.recorderWorkerPath&&e.botOptions.recorderWorkerPath.trim().length>0&&(S=e.botOptions.recorderWorkerPath.trim()),e&&e.chatContainer&&delete e.chatContainer,this.config=function(){for(var e=function(t){var a={};if("object"==typeof t){for(var n in t)t.hasOwnProperty(n)&&("object"==typeof t[n]?a[n]=e(t[n]):a[n]=t[n]);return a}return t},t=1;t<arguments.length;t++)for(var a in arguments[t])arguments[t].hasOwnProperty(a)&&("object"==typeof arguments[t][a]?arguments[0][a]=e(arguments[t][a]):arguments[0][a]=arguments[t][a]);return arguments[0]}(this.config,e),window._chatHistoryLoaded=!1,this.init(),ne(),window.addEventListener("online",ne),window.addEventListener("offline",ne)}function ne(){"boolean"==typeof _.onLine&&(_.onLine?this.hideError():this.showError("You are currently offline"))}function oe(e){if(e&&e.item(0)&&e.item(0).innerText.length){var a=document.createRange();a.selectNodeContents(e[0]),a.collapse(!1);var n=window.getSelection();n.removeAllRanges(),n.addRange(a),t=a}else t=!1,e&&e[0]&&e[0].focus()}function se(e){return e.split(".")}window.onresize=function(t){if(t.target==window&&e("#chatContainer").width(),e(".kore-chat-window").width()>400||document.getElementsByClassName("kore-chat-window").length&&document.getElementsByClassName("kore-chat-window")[0].classList.contains("expanded")){var a=e(".kore-chat-window").width();e(".carousel").attr("style","width: "+(a-85)+"px !important")}else e(".carousel").attr("style","width: 300px !important");for(var n=0;n<v.length;n++)v[n].computeResize();for(var o=document.querySelectorAll(".quickReplies"),n=0;n<o.length;n++){var s=o[n].querySelectorAll(".quick_replies_btn_parent"),i=o[n].querySelectorAll(".quickreplyLeftIcon"),l=o[n].querySelectorAll(".quickreplyRightIcon");s[0].hasChildNodes()&&(s[0].scrollLeft>0?i[0].classList.remove("hide"):i[0].classList.add("hide"),s[0].offsetWidth<s[0].scrollWidth?l[0].classList.remove("hide"):l[0].classList.add("hide"))}e(".kore-chat-window").width()>460?(e(".accordionTable").each(function(){e(this).hasClass("responsive")&&e(this).addClass("hide")}),e(".tablechartDiv").each(function(){e(this).hasClass("regular")||e(this).removeClass("hide")})):(e(".accordionTable").each(function(){e(this).hasClass("responsive")&&e(this).removeClass("hide")}),e(".tablechartDiv").each(function(){e(this).hasClass("regular")||e(this).addClass("hide")}))},ae.prototype.init=function(){var t=this;window.chatContainerConfig=t,t.config.botOptions.botInfo.name=t.config.botOptions.botInfo.name.escapeHTML(),u=t.config.botOptions.botInfo,t.config.botOptions.botInfo={chatBot:u.name,taskBotId:u._id,customData:u.customData,tenanturl:u.tenanturl},t.config.botMessages=g,t.config.chatTitle=t.config.botMessages.connecting,t.config.userAgentIE=-1!==_.userAgent.indexOf("Trident/");var a=function(){try{var e=/iphone|ipod|android|blackberry|fennec/.test(_.userAgent.toLowerCase())||window.screen.width<=480;return e}catch(e){return!1}}();a&&(t.config.isSendButton=!0),t.config.isSendButton,Y=t.config.isTTSEnabled||!1,B=t.config.allowGoogleSpeech||!1,k=t.config.isSpeechEnabled||!1,z=t.config.loadHistory||!1,D=!!z,t.config.botOptions.loadHistory=t.config.loadHistory,t.config.botOptions.chatHistory=t.config.chatHistory,t.config.botOptions.handleError=t.config.handleError,Z=t.config.autoEnableSpeechAndTTS||!1,Y&&(k||B)&&Z&&($=!0,setTimeout(function(){e(".ttspeakerDiv").removeClass("ttsOff")},350));var n=e(t.getChatTemplate()).tmpl(t.config);t.config.chatContainer=n,t.config.chatTitle="CIBIL",t.config.minimizeMode?(n.addClass("minimize"),n.find(".minimized-title").html("Chat with "+t.config.chatTitle),t.skipedInit=!0):p.init(t.config.botOptions,t.config.messageHistoryLimit),t.config.allowLocation&&p.fetchUserLocation(),t.render(n),setTimeout(function(){z&&(e(".chatInputBox").focus(),e(".disableFooter").removeClass("disableFooter"),D=!1)},2e4)},ae.prototype.destroy=function(){var t=this;e(".kore-chat-overlay").hide(),p.close(),t.config.minimizeMode||p.destroy(),M=[],t.config&&t.config.chatContainer&&(t.config.minimizeMode?(t.config.chatContainer.find(".kore-chat-header .header-title").html(t.config.botMessages.reconnecting),t.config.chatContainer.addClass("minimize"),t.skipedInit=!0):t.config.chatContainer.remove()),U&&U.stop(),$=!1,R&&(R.close(),R=null)},ae.prototype.resetWindow=function(){this.config.chatContainer.find(".kore-chat-header .header-title").html(this.config.botMessages.reconnecting),p.close(),p.init(this.config.botOptions)},ae.prototype.bindEvents=function(){var n=this,o=n.config.chatContainer;o.draggable({handle:o.find(".kore-chat-header .header-title"),containment:"document"}).resizable({handles:"n, e, w, s",containment:"document",minWidth:400}),o.off("keyup",".chatInputBox").on("keyup",".chatInputBox",function(a){var s=e(n.config.container).find(".kore-chat-footer"),i=e(n.config.container).find(".kore-chat-body");i.css("bottom",s.outerHeight()),prevComposeSelection=window.getSelection(),t=prevComposeSelection.rangeCount>0&&prevComposeSelection.getRangeAt(0),this.innerText.length>0?(o.find(".chatInputBoxPlaceholder").css("display","none"),o.find(".sendButton").removeClass("disabled")):(o.find(".chatInputBoxPlaceholder").css("display","block"),o.find(".sendButton").addClass("disabled"))}),o.on("click",".chatInputBoxPlaceholder",function(e){o.find(".chatInputBox").trigger("click"),o.find(".chatInputBox").trigger("focus")}),o.on("click",".chatInputBox",function(e){prevComposeSelection=window.getSelection(),t=prevComposeSelection.rangeCount>0&&prevComposeSelection.getRangeAt(0)}),o.on("blur",".chatInputBox",function(e){X=0}),o.off("click",".botResponseAttachments").on("click",".botResponseAttachments",function(t){window.open(e(this).attr("fileid"),"_blank")}),o.off("keydown",".chatInputBox").on("keydown",".chatInputBox",function(t){var a=e(this),o=e(n.config.container).find(".kore-chat-footer"),s=e(n.config.container).find(".kore-chat-body");if(s.css("bottom",o.outerHeight()),13===t.keyCode){if(t.shiftKey)return;return e(".upldIndc").is(":visible")?void alert("Wait until file upload is not completed"):(e(".recordingMicrophone").is(":visible")&&e(".recordingMicrophone").trigger("click"),t.preventDefault(),void n.sendMessage(a,W))}27===t.keyCode&&++X>1&&(X=0,Ce(),this.innerText="",e(".attachment").empty(),y=0,setTimeout(function(){oe(document.getElementsByClassName("chatInputBox"))},100))}),o.off("click",".sendButton").on("click",".sendButton",function(t){var a=e(".chatInputBox");e(".upldIndc").is(":visible")?alert("Wait until file upload is not completed"):(e(".recordingMicrophone").is(":visible")&&e(".recordingMicrophone").trigger("click"),t.preventDefault(),n.sendMessage(a,W))}),o.off("click",".notRecordingMicrophone").on("click",".notRecordingMicrophone",function(t){U&&U.stop(),k&&function(){if(!T)return console.warn("Please provide speech socket url"),!1;B?ge?pe?ge.stop():(me="",ge.lang="en-US",ge.start()):ye():e.ajax({url:T+"asr/wss/start?email="+C,type:"post",headers:{Authorization:b||I},dataType:"json",success:function(e){A=e.link,ye()},error:function(e){console.log(e)}})}()}),o.off("click",".recordingMicrophone").on("click",".recordingMicrophone",function(e){Ce(),setTimeout(function(){oe(document.getElementsByClassName("chatInputBox"))},350)}),o.off("click",".attachmentBtn").on("click",".attachmentBtn",function(t){1!=y?e(".upldIndc").is(":visible")?alert("Wait until file upload is not completed"):e("#captureAttachmnts").trigger("click"):alert("You can upload only one file")}),o.off("click",".removeAttachment").on("click",".removeAttachment",function(t){e(this).parents(".msgCmpt").remove(),e(".kore-chat-window").removeClass("kore-chat-attachment"),y=0,W={},e(".sendButton").addClass("disabled"),document.getElementById("captureAttachmnts").value=""}),o.off("change","#captureAttachmnts").on("change","#captureAttachmnts",function(t){var a=e("#captureAttachmnts").prop("files")[0];a&&a.size&&a.size>Q.file.limit.size?alert(Q.file.limit.msg):ke(this,a)}),o.off("paste",".chatInputBox").on("paste",".chatInputBox",function(e){e.preventDefault();var a=document.getElementsByClassName("chatInputBox"),n=e.clipboardData||e.originalEvent&&e.originalEvent.clipboardData||window.clipboardData,o="";n&&(o=te.nl2br(n.getData("text").escapeHTML(),!1))&&function(e,a){var n=e;if(sel=window.getSelection(),sel.rangeCount>0&&(range=sel.getRangeAt(0),range.deleteContents()),t=t||range){node=document.createElement("span"),t.insertNode(node);var o=document.createElement("span");o.innerHTML=a,t.insertNode(o),t.setEndAfter(node),t.setStartAfter(node),t.collapse(!1),sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(t);var s=document.activeElement;return s&&"chatInputBox"==!s.className&&n.focus(),n}n.appendChild(html)}(a,o),setTimeout(function(){oe(a)},100)}),o.off("click",".sendChat").on("click",".sendChat",function(t){var a=e(n.config.container).find(".kore-chat-footer");n.sendMessage(a.find(".chatInputBox"))}),o.off("click","li a").on("click","li a",function(t){t.preventDefault();var a=e(this).attr("href"),o=e(this).attr("target");"_self"!==o?!0===n.config.allowIframe?n.openPopup(a):window.open(a,"_blank"):callListener("provideVal",{link:a})}),o.off("click",".buttonTmplContentBox li,.listTmplContentChild .buyBtn,.viewMoreList .viewMore,.listItemPath,.quickReply,.carouselImageContent,.listRightContent,.checkboxBtn,.likeDislikeDiv").on("click",".buttonTmplContentBox li,.listTmplContentChild .buyBtn, .viewMoreList .viewMore,.listItemPath,.quickReply,.carouselImageContent,.listRightContent,.checkboxBtn,.likeDislikeDiv",function(t){t.preventDefault(),t.stopPropagation();var a=e(this).attr("type");if(a&&(a=a.toLowerCase()),"postback"==a||"text"==a){e(".chatInputBox").text(e(this).attr("actual-value")||e(this).attr("value"));var s=e(this)[0]&&e(this)[0].innerText?e(this)[0].innerText.trim():e(this)&&e(this).attr("data-value")?e(this).attr("data-value").trim():"";n.sendMessage(e(".chatInputBox"),s)}else if("url"==a||"web_url"==a){var i=e(this).attr("url");i.indexOf("http:")<0&&i.indexOf("https:")<0&&(i="http:////"+i),window.open(i,"_blank")}if(t.currentTarget.classList&&t.currentTarget.classList.length>0&&"likeDiv"===t.currentTarget.classList[1]&&(e(".likeImg").addClass("hide"),e(".likedImg").removeClass("hide"),e(".likeDislikeDiv").addClass("dummy")),t.currentTarget.classList&&t.currentTarget.classList.length>0&&"disLikeDiv"===t.currentTarget.classList[1]&&(e(".disLikeImg").addClass("hide"),e(".disLikedImg").removeClass("hide"),e(".likeDislikeDiv").addClass("dummy")),t.currentTarget.classList&&t.currentTarget.classList.length>0&&"checkboxBtn"===t.currentTarget.classList[0]){for(var l=e(t.currentTarget.parentElement.parentElement).find(".checkInput:checked"),r=[],c=[],d=0;d<l.length;d++)r.push(e(l[d]).attr("value")),c.push(e(l[d]).attr("text"));e(".chatInputBox").text(e(this).attr("value")+": "+r.toString()),n.sendMessage(e(".chatInputBox"),e(this).attr("title")+":"+c.toString())}if(t.currentTarget.classList&&t.currentTarget.classList.length>0&&"quickReply"===t.currentTarget.classList[0]){var m=t.currentTarget.parentElement.parentElement,p=m.parentElement.parentElement.querySelectorAll(".quickreplyLeftIcon"),g=m.parentElement.parentElement.querySelectorAll(".quickreplyRightIcon");setTimeout(function(){m.parentElement.parentElement.getElementsByClassName("user-account")[0].classList.remove("marginT50"),m.parentElement.parentElement.removeChild(p[0]),m.parentElement.parentElement.removeChild(g[0]),m.parentElement.removeChild(m)},50)}setTimeout(function(){var e=o.find(".kore-chat-footer .chatInputBox");e.focus()},600)}),o.off("click",".close-btn").on("click",".close-btn",function(t){e(".recordingMicrophone").trigger("click"),U&&U.stop(),$=!1,n.destroy(),R&&(R.close(),R=null)}),o.off("click",".minimize-btn").on("click",".minimize-btn",function(t){!0===n.minimized?(o.removeClass("minimize"),n.minimized=!1,n.expanded):(o.addClass("minimize"),!1===n.expanded&&o.hasClass("ui-draggable"),o.find(".minimized-title").html("Chat with "+n.config.chatTitle),n.minimized=!0,!0===n.expanded&&e(".kore-chat-overlay").hide()),e(".recordingMicrophone").trigger("click"),U&&U.stop()}),o.off("click",".expand-btn").on("click",".expand-btn",function(t){0===e(".kore-chat-overlay").length&&e(n.config.container).append('<div class="kore-chat-overlay"></div>'),!0===n.expanded?(e(".kore-chat-overlay").hide(),e(this).attr("title","Expand"),o.removeClass("expanded"),e(".expand-btn-span").removeClass("fa-compress"),e(".expand-btn-span").addClass("fa-expand"),n.expanded=!1):(e(".kore-chat-overlay").show(),e(this).attr("title","Collapse"),o.addClass("expanded"),e(".expand-btn-span").addClass("fa-compress"),e(".expand-btn-span").removeClass("fa-expand"),n.expanded=!0);var a=document.createEvent("HTMLEvents");a.initEvent("resize",!0,!1),window.dispatchEvent(a);var s=o.position().left+o.width();s>e(window).width()&&o.css("left",o.position().left-(s-e(window).width()+10)+"px")}),e(document).on("keyup",function(t){27==t.keyCode&&(e(".closeImagePreview").trigger("click"),e(".closeElePreview").trigger("click"))}),o.off("click",".quickreplyLeftIcon").on("click",".quickreplyLeftIcon",function(t){var a=t.currentTarget.parentElement.getElementsByClassName("buttonTmplContentChild");if(a.length)for(var n=t.target.parentElement.getElementsByClassName("quick_replies_btn_parent"),o=n[0].scrollLeft,s=0,i=0;i<a.length;i++)if((s+=a[i].offsetWidth+10)>o){e(n).animate({scrollLeft:o-a[i].offsetWidth-50},"slow",function(){var e=n[0].parentElement.querySelectorAll(".quickreplyRightIcon");if(e[0].classList.remove("hide"),n[0].scrollLeft<=0){var t=n[0].parentElement.querySelectorAll(".quickreplyLeftIcon");t[0].classList.add("hide")}});break}}),o.off("click",".quickreplyRightIcon").on("click",".quickreplyRightIcon",function(t){var a=t.currentTarget.parentElement.getElementsByClassName("buttonTmplContentChild");if(a.length)for(var n=t.target.parentElement.getElementsByClassName("quick_replies_btn_parent"),o=t.target.parentElement.offsetWidth,s=0,i=0;i<a.length;i++)if((s+=a[i].offsetWidth+10)>o){e(n).animate({scrollLeft:n[0].scrollLeft+a[i].offsetWidth+20},"slow",function(){var e=n[0].parentElement.querySelectorAll(".quickreplyLeftIcon");if(e[0].classList.remove("hide"),n[0].scrollLeft+o+10>=n[0].scrollWidth){var t=n[0].parentElement.querySelectorAll(".quickreplyRightIcon");t[0].classList.add("hide")}});break}}),o.off("click",".minimized").on("click",".minimized,.minimized-title",function(t){o.removeClass("minimize"),n.minimized=!1,n.skipedInit&&(p.init(n.config.botOptions,n.config.messageHistoryLimit),n.skipedInit=!1),!0===n.expanded&&e(".kore-chat-overlay").show();var a=document.createEvent("HTMLEvents");a.initEvent("resize",!0,!1),e(".chat-container").animate({scrollTop:e(".chat-container").prop("scrollHeight")},100)}),o.off("click",".reload-btn").on("click",".reload-btn",function(t){e(this).addClass("disabled").prop("disabled",!0),e(".close-btn").addClass("disabled").prop("disabled",!0),setTimeout(function(){n.resetWindow()}),e(".recordingMicrophone").trigger("click"),U&&U.stop()}),o.off("click",".ttspeaker").on("click",".ttspeaker",function(t){Y&&($?(U&&U.stop(),xe(),$=!1,e("#ttspeaker")[0].pause(),e(".ttspeakerDiv").addClass("ttsOff")):(H=we(),$=!0,e(".ttspeakerDiv").removeClass("ttsOff")))}),p.on("open",function(t){a=n.config.botOptions.accessToken,o.find(".kore-chat-footer .chatInputBox"),o.find(".kore-chat-header .header-title").html("Chat with CIBIL").attr("title",n.config.chatTitle),o.find(".kore-chat-header .disabled").prop("disabled",!1).removeClass("disabled"),z||setTimeout(function(){e(".chatInputBox").focus(),e(".disableFooter").removeClass("disableFooter")})}),p.on("message",function(t){!0===n.popupOpened&&e(".kore-auth-popup .close-popup").trigger("click");var a=JSON.parse(t.data);if("bot"===a.from&&"bot_response"===a.type){if(a.message[0]){if(a.message[0].cInfo||(a.message[0].cInfo={}),a.message[0].component&&!a.message[0].component.payload.text)try{a.message[0].component=JSON.parse(a.message[0].component.payload)}catch(e){a.message[0].component=a.message[0].component.payload}a.message[0].component&&a.message[0].component.payload&&a.message[0].component.payload.text&&(a.message[0].cInfo.body=a.message[0].component.payload.text),a.message[0].component&&a.message[0].component.payload&&(a.message[0].component.payload.videoUrl||a.message[0].component.payload.audioUrl)&&(a.message[0].cInfo.body=a.message[0].component.payload.text||"")}z&&D?M.push(a):n.renderMessage(a)}else if("self"===a.from&&"user_message"===a.type){var o=a.message,s={};s=o&&o.attachments&&o.attachments[0]&&o.attachments[0].fileId?{type:"currentUser",message:[{type:"text",cInfo:{body:o.body,attachments:o.attachments},clientMessageId:a.id}],createdOn:a.id}:{type:"currentUser",message:[{type:"text",cInfo:{body:o.body},clientMessageId:a.id}],createdOn:a.id},n.renderMessage(s)}"appInvalidNotification"===a.type&&setTimeout(function(){e(".trainWarningDiv").addClass("showMsg")},2e3)});var s=document.querySelector(".droppable");!function(e,t){var a=document.createElement("input");function n(e){var a;e.dataTransfer?a=e.dataTransfer.files:e.target&&(a=e.target.files),t.call(null,a)}a.setAttribute("type","file"),a.setAttribute("multiple",!1),a.style.display="none",a.addEventListener("change",n),e.appendChild(a),e.addEventListener("dragover",function(t){t.preventDefault(),t.stopPropagation(),e.classList.add("dragover")}),e.addEventListener("dragleave",function(t){t.preventDefault(),t.stopPropagation(),e.classList.remove("dragover")}),e.addEventListener("drop",function(t){t.preventDefault(),t.stopPropagation(),e.classList.remove("dragover"),n(t)})}(s,function(e){1!=y?(ke(this,e[0]),e.length>1&&alert("You can upload only one file")):alert("You can upload only one file")})},ae.prototype.bindIframeEvents=function(t){var a=this;t.on("click",".close-popup",function(){e(this).closest(".kore-auth-popup").remove(),e(".kore-auth-layover").remove(),a.popupOpened=!1});var n=t.find("iframe")[0];n.addEventListener("onload",function(){console.log(this)},!0)},ae.prototype.render=function(t){var a=this;e(a.config.container).append(t),"body"!==a.config.container&&(e(a.config.container).addClass("pos-relative"),e(a.config.chatContainer).addClass("pos-absolute")),a.bindEvents()},ae.prototype.sendMessage=function(t,a,n){if(""!==t.text().trim()||0!=e(".attachment").html().trim().length){this.config.allowLocation&&p.fetchUserLocation();var o=e(this.config.chatContainer).find(".kore-chat-body"),s=e(this.config.chatContainer).find(".kore-chat-footer"),i=(new Date).getTime(),l={};y=0,t.html(t.html().replaceAll("<br>","\n")),W&&Object.keys(W).length?(l={type:"currentUser",message:[{type:"text",cInfo:{body:t.text(),attachments:[W]},clientMessageId:i}],createdOn:i},e(".attachment").html(""),e(".kore-chat-window").removeClass("kore-chat-attachment"),document.getElementById("captureAttachmnts").value=""):(W={},l={type:"currentUser",message:[{type:"text",cInfo:{body:t.text()},clientMessageId:i}],createdOn:i});var r={};r.clientMessageId=i,Object.keys(W).length>0&&t.text().trim().length?r.message={body:t.text().trim(),attachments:[W]}:Object.keys(W).length>0?r.message={attachments:[W]}:r.message={body:t.text().trim()},r.resourceid="/bot.message",a&&"string"==typeof a&&(r.message.renderMsg=a),n&&n.customdata&&(r.message.customdata=n.customdata),n&&n.nlmeta&&(r.message.nlmeta=n.nlmeta),W={},p.sendMessage(r,function(t){t&&t.message&&setTimeout(function(){e("#msg_"+i).find(".messageBubble").append('<div class="errorMsg">Send Failed. Please resend.</div>')},350)}),t.html(""),e(".sendButton").addClass("disabled"),o.css("bottom",s.outerHeight()),function e(){clearTimeout(m),m=setTimeout(function(){var t={type:"ping"};p.sendMessage(t,function(){}),e()},j)}(),e(".typingIndicatorContent").css("display","block"),setTimeout(function(){e(".typingIndicatorContent").css("display","none")},1e4),a&&"string"==typeof a&&(l.message[0].cInfo.body=a),this.renderMessage(l)}},ae.prototype.renderMessage=function(t){var a=this,n="",o="",s="";J.helpers=te,J.extension=o,graphLibGlob=a.config.graphLib||"d3","bot_response"===t.type?(N=!1,setTimeout(function(){e(".typingIndicator").css("background-image","url("+t.icon+")")},500),setTimeout(function(){N||e(".typingIndicatorContent").css("display","none")},500)):N=!1;var i=e(a.config.chatContainer).find(".chat-container");if(t.message&&t.message[0]&&t.message[0].cInfo&&t.message[0].cInfo.attachments&&(o=se(t.message[0].cInfo.attachments[0].fileName)),t.message&&t.message[0]&&t.message[0].component&&t.message[0].component.payload&&t.message[0].component.payload.url&&(o=se(t.message[0].component.payload.url),s=t.message[0].component.payload.url.replace(/^.*[\\\/]/,"")),""===(n=J.renderMessage(t))&&t&&t.message&&t.message[0])if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"button"==t.message[0].component.payload.template_type)n=e(a.getChatTemplate("templatebutton")).tmpl({msgData:t,helpers:te,extension:o});else{if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"wait_for_response"==t.message[0].component.payload.template_type)return N=!0,void e(".typingIndicatorContent").css("display","block");if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"list"==t.message[0].component.payload.template_type)n=e(a.getChatTemplate("templatelist")).tmpl({msgData:t,helpers:te,extension:o});else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"quick_replies"==t.message[0].component.payload.template_type)n=e(a.getChatTemplate("templatequickreply")).tmpl({msgData:t,helpers:te,extension:o}),setTimeout(function(){var e=document.createEvent("HTMLEvents");e.initEvent("resize",!0,!1),window.dispatchEvent(e)},150);else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"carousel"==t.message[0].component.payload.template_type)n=e(a.getChatTemplate("carouselTemplate")).tmpl({msgData:t,helpers:te,extension:o}),setTimeout(function(){e(".carousel:last").addClass("carousel"+L);var t=e(".carousel"+L).children().length;if(t>1){var a=new PureJSCarousel({carousel:".carousel"+L,slide:".slide",oneByOne:!0});e(".carousel"+L).parent().show(),e(".carousel"+L).attr("style","height: 100% !important"),v.push(a)}var n=document.createEvent("HTMLEvents");n.initEvent("resize",!0,!1),window.dispatchEvent(n),L+=1,i.animate({scrollTop:i.prop("scrollHeight")},0)});else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&("image"==t.message[0].component.type||"audio"==t.message[0].component.type||"video"==t.message[0].component.type||"link"==t.message[0].component.type))n=e(a.getChatTemplate("templateAttachment")).tmpl({msgData:t,helpers:te,extension:o,extractedFileName:s});else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"table"==t.message[0].component.payload.template_type)n=e(a.getChatTemplate("tableChartTemplate")).tmpl({msgData:t,helpers:te,extension:o}),setTimeout(function(){for(var t=document.getElementsByClassName("accordionRow"),a=0;a<t.length;a++)t[a].onclick=function(){this.classList.toggle("open")};for(var n=document.getElementsByClassName("showMore"),a=0;a<n.length;a++)n[a].onclick=function(){var t=this.parentNode.parentElement;e("#dialog").empty(),e("#dialog").html(e(t).find(".tablechartDiv").html()),e(".hello").clone().appendTo(".goodbye");var a=document.getElementById("myPreviewModal");e(".largePreviewContent").empty(),e(t).find(".tablechartDiv").clone().appendTo(".largePreviewContent"),a.style.display="block";var n=document.getElementsByClassName("closeElePreview")[0];n.onclick=function(){a.style.display="none",e(".largePreviewContent").removeClass("addheight")}}},350);else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"mini_table"==t.message[0].component.payload.template_type)"horizontal"==t.message[0].component.payload.layout?(n=e(a.getChatTemplate("miniTableHorizontalTemplate")).tmpl({msgData:t,helpers:te,extension:o}),setTimeout(function(){e(".carousel:last").addClass("carousel"+L);var t=e(".carousel"+L).children().length;if(t>1){var a=new PureJSCarousel({carousel:".carousel"+L,slide:".slide",oneByOne:!0});e(".carousel"+L).parent().show(),e(".carousel"+L).attr("style","height: 100% !important"),v.push(a)}var n=document.createEvent("HTMLEvents");n.initEvent("resize",!0,!1),window.dispatchEvent(n),L+=1,i.animate({scrollTop:i.prop("scrollHeight")},0)})):n=e(a.getChatTemplate("miniTableChartTemplate")).tmpl({msgData:t,helpers:te,extension:o});else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"multi_select"==t.message[0].component.payload.template_type)n=e(this.getChatTemplate("checkBoxesTemplate")).tmpl({msgData:t,helpers:te,extension:o});else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"like_dislike"==t.message[0].component.payload.template_type)n=e(this.getChatTemplate("likeDislikeTemplate")).tmpl({msgData:t,helpers:te,extension:o});else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"piechart"==t.message[0].component.payload.template_type)n=e(a.getChatTemplate("pieChartTemplate")).tmpl({msgData:t,helpers:te,extension:o}),"google"===a.config.graphLib?setTimeout(function(){google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(function(){var e=new google.visualization.DataTable;e.addColumn("string","Task"),e.addColumn("number","Hours per Day"),t.message[0].component.payload.elements&&t.message[0].component.payload.elements[0].displayValue&&e.addColumn({type:"string",role:"tooltip"});for(var a=[],n=t.message[0].component.payload.elements,o=0;o<n.length;o++){var s=[n[o].title+" \n"+n[o].value];s.push(parseFloat(n[o].value)),n[o].displayValue&&s.push(n[o].displayValue),a.push(s)}e.addRows(a);var i={chartArea:{left:"3%",top:"3%",height:"94%",width:"94%"},pieSliceTextStyle:{},colors:window.chartColors,legend:{textStyle:{color:"#b3bac8"}}};1===n.length&&(i.pieHole=.5,i.pieSliceTextStyle.color="black"),t.message[0].component.payload.pie_type&&("donut"===t.message[0].component.payload.pie_type?(i.pieHole=.6,i.pieSliceTextStyle.color="black",i.legend.position="none"):"donut_legend"===t.message[0].component.payload.pie_type&&(i.pieHole=.6,i.pieSliceTextStyle.color="black"));var l={id:"piechart"+t.messageId,data:e,options:i,type:"piechart"};q.push(l);var r=document.getElementById("piechart"+t.messageId);new google.visualization.PieChart(r).draw(e,i)})},150):"d3"===graphLibGlob&&(void 0===t.message[0].component.payload.pie_type&&(t.message[0].component.payload.pie_type="regular"),t.message[0].component.payload.pie_type&&((l={}).width=300,l.height=200,l.legendRectSize=10,l.legendSpacing=2.4,"regular"===t.message[0].component.payload.pie_type?setTimeout(function(){var e={id:"piechart"+t.messageId,data:t,type:"regular"};q.push(e),KoreGraphAdapter.drawD3Pie(t,l,"#piechart"+t.messageId,12)},150):"donut"===t.message[0].component.payload.pie_type?setTimeout(function(){var e={id:"piechart"+t.messageId,data:t,type:"donut"};q.push(e),KoreGraphAdapter.drawD3PieDonut(t,l,"#piechart"+t.messageId,12,"donut")},150):"donut_legend"===t.message[0].component.payload.pie_type&&setTimeout(function(){var e={id:"piechart"+t.messageId,data:t,type:"donut_legend"};q.push(e),KoreGraphAdapter.drawD3PieDonut(t,l,"#piechart"+t.messageId,12,"donut_legend")},150))),setTimeout(function(){e(".chat-container").scrollTop(e(".chat-container").prop("scrollHeight")),Ge()},200);else if(t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"barchart"==t.message[0].component.payload.template_type){if(n=e(a.getChatTemplate("barchartTemplate")).tmpl({msgData:t,helpers:te,extension:o}),"google"===graphLibGlob)setTimeout(function(){google.charts.load("current",{packages:["corechart","bar"]}),google.charts.setOnLoadCallback(function(){var e=!1,a=new google.visualization.DataTable;a.addColumn("string","y");for(var n=0;n<t.message[0].component.payload.elements.length;n++){var o=t.message[0].component.payload.elements[n];a.addColumn("number",o.title),o.displayValues&&o.displayValues.length&&(a.addColumn({type:"string",role:"tooltip"}),e=!0)}for(var s=t.message[0].component.payload.elements.length,n=0;n<t.message[0].component.payload.X_axis.length;n++){var i=[];i.push(t.message[0].component.payload.X_axis[n]);for(var l=0;l<s;l++)i.push(parseFloat(t.message[0].component.payload.elements[l].values[n])),e&&i.push(t.message[0].component.payload.elements[l].displayValues[n]);a.addRow(i)}var r={chartArea:{height:"70%",width:"80%"},legend:{position:"top",alignment:"end",maxLines:3,textStyle:{color:"#b3bac8"}},hAxis:{gridlines:{color:"transparent"},textStyle:{color:"#b3bac8"}},vAxis:{gridlines:{color:"transparent"},textStyle:{color:"#b3bac8"},baselineColor:"transparent"},animation:{duration:500,easing:"out",startup:!0},bar:{groupWidth:"25%"},colors:window.chartColors};"vertical"!==t.message[0].component.payload.direction&&(r.bar.groupWidth="45%",r.hAxis.baselineColor="#b3bac8"),t.message[0].component.payload.stacked&&(r.isStacked=!0,r.bar.groupWidth="25%");var c={id:"barchart"+t.messageId,direction:t.message[0].component.payload.direction,data:a,options:r,type:"barchart"};q.push(c);var d=document.getElementById("barchart"+t.messageId);("vertical"===t.message[0].component.payload.direction?new google.visualization.ColumnChart(d):new google.visualization.BarChart(d)).draw(a,r)})},150);else if("d3"===graphLibGlob){var l={outerWidth:350,outerHeight:300,innerHeight:200,legendRectSize:15,legendSpacing:4};void 0===t.message[0].component.payload.direction&&(t.message[0].component.payload.direction="horizontal"),"horizontal"!==t.message[0].component.payload.direction||t.message[0].component.payload.stacked?"vertical"===t.message[0].component.payload.direction&&t.message[0].component.payload.stacked?setTimeout(function(){l.outerWidth=350,l.innerWidth=270;var e={id:"barchart"+t.messageId,data:t,type:"stackedBarchart"};q.push(e),KoreGraphAdapter.drawD3barVerticalStackedChart(t,l,"#barchart"+t.messageId,12)},250):"horizontal"===t.message[0].component.payload.direction&&t.message[0].component.payload.stacked?setTimeout(function(){l.innerWidth=180;var e={id:"barchart"+t.messageId,data:t,type:"stackedBarchart"};q.push(e),KoreGraphAdapter.drawD3barStackedChart(t,l,"#barchart"+t.messageId,12)},250):"vertical"!==t.message[0].component.payload.direction||t.message[0].component.payload.stacked||setTimeout(function(){l.innerWidth=240;var e={id:"barchart"+t.messageId,data:t,type:"barchart"};q.push(e),KoreGraphAdapter.drawD3barChart(t,l,"#barchart"+t.messageId,12)},250):setTimeout(function(){l.innerWidth=180;var e={id:"Legend_barchart"+t.messageId,data:t,type:"barchart"};q.push(e),KoreGraphAdapter.drawD3barHorizontalbarChart(t,l,"#barchart"+t.messageId,12)},250)}setTimeout(function(){e(".chat-container").scrollTop(e(".chat-container").prop("scrollHeight")),Ge()},300)}else t.message[0]&&t.message[0].component&&t.message[0].component.payload&&"linechart"==t.message[0].component.payload.template_type?(n=e(a.getChatTemplate("linechartTemplate")).tmpl({msgData:t,helpers:te,extension:o}),"google"===graphLibGlob?setTimeout(function(){google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback(function(){var e=!1,a=new google.visualization.DataTable;a.addColumn("string","y");for(var n=0;n<t.message[0].component.payload.elements.length;n++){var o=t.message[0].component.payload.elements[n];a.addColumn("number",o.title),o.displayValues&&o.displayValues.length&&(a.addColumn({type:"string",role:"tooltip"}),e=!0)}for(var s=t.message[0].component.payload.elements.length,n=0;n<t.message[0].component.payload.X_axis.length;n++){var i=[];i.push(t.message[0].component.payload.X_axis[n]);for(var l=0;l<s;l++)i.push(parseFloat(t.message[0].component.payload.elements[l].values[n])),e&&i.push(t.message[0].component.payload.elements[l].displayValues[n]);a.addRow(i)}var r={curveType:"function",chartArea:{height:"70%",width:"80%"},legend:{position:"top",alignment:"end",maxLines:3,textStyle:{color:"#b3bac8"}},hAxis:{gridlines:{color:"transparent"},textStyle:{color:"#b3bac8"}},vAxis:{gridlines:{color:"transparent"},textStyle:{color:"#b3bac8"},baselineColor:"transparent"},lineWidth:3,animation:{duration:500,easing:"out",startup:!0},colors:window.chartColors},c={id:"linechart"+t.messageId,data:a,options:r,type:"linechart"};q.push(c);var d=document.getElementById("linechart"+t.messageId);new google.visualization.LineChart(d).draw(a,r)})},150):"d3"===graphLibGlob&&setTimeout(function(){var e={outerWidth:380,outerHeight:350,innerWidth:230,innerHeight:250,legendRectSize:15,legendSpacing:4},a={id:"linechart"+t.messageId,data:t,type:"linechart"};q.push(a),KoreGraphAdapter.drawD3lineChartV2(t,e,"#linechart"+t.messageId,12)},250),setTimeout(function(){e(".chat-container").scrollTop(e(".chat-container").prop("scrollHeight")),Ge()},200)):n=e(a.getChatTemplate("message")).tmpl({msgData:t,helpers:te,extension:o})}if(i.append(n),function(){var e=document.getElementById("myModal"),t=(document.getElementById("myImg"),document.getElementById("img01")),a=document.getElementById("caption");if(document.querySelectorAll(".messageBubble img").length>0)for(var n=0;n<document.querySelectorAll(".messageBubble img").length;n++){var o=document.querySelectorAll(".messageBubble img")[n];o.addEventListener("click",function(n){n.stopPropagation(),n.stopImmediatePropagation(),e.style.display="block",t.src=this.src,a.innerHTML=this.alt})}document.getElementsByClassName("closeImagePreview")[0].onclick=function(){e.style.display="none"}}(),i.animate({scrollTop:i.prop("scrollHeight")},100),"bot_response"===t.type&&$&&Y&&!a.minimized&&!D){if(t.message[0]&&t.message[0].component&&"template"===t.message[0].component.type)P="";else try{P=t.message[0].component.payload.text?t.message[0].component.payload.text.replace(/\r?\n/g,". ."):"",P=(P=(P=te.checkMarkdowns(P)).replace("___","<hr/>")).replace("---","<hr/>")}catch(e){P=""}t.message[0].component&&t.message[0].component.payload.speech_hint&&(P=t.message[0].component.payload.speech_hint),H=we(P)}},ae.prototype.formatMessages=function(t){e(t).find("a").attr("target","_blank")},ae.prototype.openPopup=function(t){var a=e(this.getChatTemplate("popup")).tmpl({link_url:t});e(this.config.container).append(a),this.popupOpened=!0,this.bindIframeEvents(e(a))},ae.prototype.getChatTemplate=function(e){return"message"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         {{each(key, msgItem) msgData.message}}                             {{if msgItem.cInfo && msgItem.type === "text"}}                                 <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} {{if msgData.icon}}with-icon{{/if}}">                                     {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                                     {{if msgData.icon}}<div aria-live="off" class="profile-photo"> <div class="user-account avtar" style="background-image:url(${msgData.icon})" title="User Avatar"></div> </div> {{/if}}                                     <div aria-live="assertive"  class="messageBubble">                                        <div>                                             {{if msgData.type === "bot_response"}}                                                 {{if msgItem.component  && msgItem.component.type =="error"}}                                                     <span style="color:${msgItem.component.payload.color}">{{html helpers.convertMDtoHTML(msgItem.component.payload.text, "bot")}} </span>                                                 {{else}}                                                     {{html helpers.convertMDtoHTML(msgItem.cInfo.body, "bot")}}                                                     {{if msgItem.component && msgItem.component.payload && msgItem.component.payload.videoUrl}}                                                        <div class="videoEle"><video width="300" controls><source src="${msgItem.component.payload.videoUrl}" type="video/mp4"></video></div>                                                    {{/if}}                                                    {{if msgItem.component && msgItem.component.payload && msgItem.component.payload.audioUrl}}                                                        <div class="audioEle"><audio width="180" controls><source src="${msgItem.component.payload.audioUrl}"></audio></div>                                                    {{/if}}                                                {{/if}}                                             {{else}}                                                 {{if msgItem.cInfo.renderMsg && msgItem.cInfo.renderMsg !== ""}}                                                    {{html helpers.convertMDtoHTML(msgItem.cInfo.renderMsg, "user")}}                                                 {{else}}                                                    {{html helpers.convertMDtoHTML(msgItem.cInfo.body, "user")}}                                                 {{/if}}                                            {{/if}}                                         </div>                                        {{if msgItem.cInfo && msgItem.cInfo.emoji}}                                             <span class="emojione emojione-${msgItem.cInfo.emoji[0].code}">${msgItem.cInfo.emoji[0].title}</span>                                         {{/if}}                                         {{if msgItem.cInfo.attachments}}                                             <div class="msgCmpt attachments" fileid="${msgItem.cInfo.attachments[0].fileId}">                                                 <div class="uploadedFileIcon">                                                     {{if msgItem.cInfo.attachments[0].fileType == "image"}}                                                         <span class="icon cf-icon icon-photos_active"></span>                                                     {{else msgItem.cInfo.attachments[0].fileType == "audio"}}                                                        <span class="icon cf-icon icon-files_audio"></span>                                                     {{else msgItem.cInfo.attachments[0].fileType == "video"}}                                                         <span class="icon cf-icon icon-video_active"></span>                                                     {{else}}                                                         {{if extension[1]=="xlsx" || extension[1]=="xls" || extension[1]=="docx" || extension[1]=="doc" || extension[1]=="pdf" || extension[1]=="ppsx" || extension[1]=="pptx" || extension[1]=="ppt" || extension[1]=="zip" || extension[1]=="rar"}}                                                            <span class="icon cf-icon icon-files_${extension[1]}"></span>                                                         {{else extension[1]}}                                                            <span class="icon cf-icon icon-files_other_doc"></span>                                                         {{/if}}                                                    {{/if}}                                                </div>                                                 <div class="curUseruploadedFileName">${msgItem.cInfo.attachments[0].fileName}</div>                                             </div>                                         {{/if}}                                         {{if msgData.isError}}                                             <div class="errorMsg">Send Failed. Please resend.</div>                                         {{/if}}                                     </div>                                 </li>                             {{/if}}                         {{/each}}                     {{/if}}                 </scipt>':"popup"===e?'<script id="kore_popup_tmpl" type="text/x-jquery-tmpl">                         <div class="kore-auth-layover">                            <div class="kore-auth-popup">                                 <div class="popup_controls"><span class="close-popup" title="Close">&times;</span></div>                                 <iframe id="authIframe" src="${link_url}"></iframe>                             </div>                         </div>                <\/script>':"templatebutton"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon">                             <div class="buttonTmplContent">                                 {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                                 {{if msgData.icon}}<div aria-live="off" class="profile-photo"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                                 <ul class="buttonTmplContentBox">                                    <li class="buttonTmplContentHeading">                                         {{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "user")}} {{/if}}                                         {{if msgData.message[0].cInfo && msgData.message[0].cInfo.emoji}}                                             <span class="emojione emojione-${msgData.message[0].cInfo.emoji[0].code}">${msgData.message[0].cInfo.emoji[0].title}</span>                                         {{/if}}                                     </li>                                    {{each(key, msgItem) msgData.message[0].component.payload.buttons}}                                         <a href=""#>                                            <li {{if msgItem.payload}}value="${msgItem.payload}"{{/if}} {{if msgItem.payload}}actual-value="${msgItem.payload}"{{/if}} {{if msgItem.url}}url="${msgItem.url}"{{/if}} class="buttonTmplContentChild" data-value="${msgItem.value}" type="${msgItem.type}">                                                ${msgItem.title}                                            </li>                                         </a>                                     {{/each}}                                 </ul>                            </div>                        </li>                     {{/if}}                 </scipt>':"templatelist"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon">                             <div class="listTmplContent">                                 {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                                 {{if msgData.icon}}<div aria-live="off" class="profile-photo"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                                 <ul class="listTmplContentBox">                                     {{if msgData.message[0].component.payload.text || msgData.message[0].component.payload.heading}}                                         <li class="listTmplContentHeading">                                             {{if msgData.type === "bot_response" && msgData.message[0].component.payload.heading}} {{html helpers.convertMDtoHTML(msgData.message[0].component.payload.heading, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "user")}} {{/if}}                                             {{if msgData.message[0].cInfo && msgData.message[0].cInfo.emoji}}                                                 <span class="emojione emojione-${msgData.message[0].cInfo.emoji[0].code}">${msgData.message[0].cInfo.emoji[0].title}</span>                                             {{/if}}                                         </li>                                     {{/if}}                                     {{each(key, msgItem) msgData.message[0].component.payload.elements}}                                         {{if msgData.message[0].component.payload.buttons}}                                             {{if key<= 2 }}                                                <li class="listTmplContentChild">                                                     {{if msgItem.image_url}}                                                         <div class="listRightContent" {{if msgItem.default_action && msgItem.default_action.url}}url="${msgItem.default_action.url}"{{/if}} {{if msgItem.default_action && msgItem.default_action.title}}data-value="${msgItem.default_action.title}"{{/if}} {{if msgItem.default_action && msgItem.default_action.type}}type="${msgItem.default_action.type}"{{/if}} {{if msgItem.default_action && msgItem.default_action.payload}} value="${msgItem.default_action.payload}"{{/if}}>                                                             <img alt="image" src="${msgItem.image_url}" onerror="this.onerror=null;this.src=\'../libs/img/no_image.png\';"/>                                                         </div>                                                     {{/if}}                                                     <div class="listLeftContent">                                                         <div class="listItemTitle">{{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgItem.title, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgItem.title, "user")}} {{/if}}</div>                                                         {{if msgItem.subtitle}}<div class="listItemSubtitle">{{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgItem.subtitle, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgItem.subtitle, "user")}} {{/if}}</div>{{/if}}                                                         {{if msgItem.default_action && msgItem.default_action.url}}<div class="listItemPath" type="url" url="${msgItem.default_action.url}">${msgItem.default_action.url}</div>{{/if}}                                                         {{if msgItem.buttons}}                                                        <div>                                                             <span class="buyBtn" {{if msgItem.buttons[0].type}}type="${msgItem.buttons[0].type}"{{/if}} {{if msgItem.buttons[0].url}}url="${msgItem.buttons[0].url}"{{/if}} {{if msgItem.buttons[0].payload}}value="${msgItem.buttons[0].payload}"{{/if}}>{{if msgItem.buttons[0].title}}${msgItem.buttons[0].title}{{else}}Buy{{/if}}</span>                                                         </div>                                                         {{/if}}                                                    </div>                                                </li>                                             {{/if}}                                        {{else}}                                             <li class="listTmplContentChild">                                                 {{if msgItem.image_url}}                                                     <div class="listRightContent" {{if msgItem.default_action && msgItem.default_action.url}}url="${msgItem.default_action.url}"{{/if}} {{if msgItem.default_action && msgItem.default_action.title}}data-value="${msgItem.default_action.title}"{{/if}} {{if msgItem.default_action && msgItem.default_action.type}}type="${msgItem.default_action.type}"{{/if}} {{if msgItem.default_action && msgItem.default_action.payload}} value="${msgItem.default_action.payload}"{{/if}}>                                                         <img alt="image" src="${msgItem.image_url}" onerror="this.onerror=null;this.src=\'../libs/img/no_image.png\';" />                                                     </div>                                                 {{/if}}                                                 <div class="listLeftContent">                                                     <div class="listItemTitle">{{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgItem.title, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgItem.title, "user")}} {{/if}}</div>                                                     {{if msgItem.subtitle}}<div class="listItemSubtitle">{{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgItem.subtitle, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgItem.subtitle, "user")}} {{/if}}</div>{{/if}}                                                     {{if msgItem.default_action && msgItem.default_action.url}}<div class="listItemPath" type="url" url="${msgItem.default_action.url}">${msgItem.default_action.url}</div>{{/if}}                                                     {{if msgItem.buttons}}                                                    <div>                                                         <span class="buyBtn" {{if msgItem.buttons[0].type}}type="${msgItem.buttons[0].type}"{{/if}} {{if msgItem.buttons[0].url}}url="${msgItem.buttons[0].url}"{{/if}} {{if msgItem.buttons[0].payload}}value="${msgItem.buttons[0].payload}"{{/if}}>{{if msgItem.buttons[0].title}}${msgItem.buttons[0].title}{{else}}Buy{{/if}}</span>                                                     </div>                                                     {{/if}}                                                </div>                                            </li>                                         {{/if}}                                     {{/each}}                                     </li>                                     {{if msgData.message[0].component.AlwaysShowGlobalButtons || (msgData.message[0].component.payload.elements.length > 3 && msgData.message[0].component.payload.buttons)}}                                    <li class="viewMoreList">                                         <span class="viewMore" url="{{if msgData.message[0].component.payload.buttons[0].url}}${msgData.message[0].component.payload.buttons[0].url}{{/if}}" type="${msgData.message[0].component.payload.buttons[0].type}" value="{{if msgData.message[0].component.payload.buttons[0].payload}}${msgData.message[0].component.payload.buttons[0].payload}{{else}}${msgData.message[0].component.payload.buttons[0].title}{{/if}}">${msgData.message[0].component.payload.buttons[0].title}</span>                                     </li>                                     {{/if}}                                </ul>                             </div>                         </li>                     {{/if}}                 </scipt>':"templatequickreply"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon quickReplies">                             <div class="buttonTmplContent">                                 {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                                 {{if msgData.icon}}<div aria-live="off" class="profile-photo"> <div class="user-account avtar marginT50" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                                 {{if msgData.message[0].component.payload.text}}                                     <div class="buttonTmplContentHeading quickReply">                                         {{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "user")}} {{/if}}                                         {{if msgData.message[0].cInfo && msgData.message[0].cInfo.emoji}}                                             <span class="emojione emojione-${msgData.message[0].cInfo.emoji[0].code}">${msgData.message[0].cInfo.emoji[0].title}</span>                                         {{/if}}                                     </div>                                    {{/if}}                                     {{if msgData.message[0].component.payload.quick_replies && msgData.message[0].component.payload.quick_replies.length}}                                     <div class="fa fa-chevron-left quickreplyLeftIcon hide"></div><div class="fa fa-chevron-right quickreplyRightIcon"></div>                                        <div class="quick_replies_btn_parent"><div class="autoWidth">                                            {{each(key, msgItem) msgData.message[0].component.payload.quick_replies}}                                                 <div class="buttonTmplContentChild quickReplyDiv"> <span {{if msgItem.payload}}value="${msgItem.payload}"{{/if}} class="quickReply {{if msgItem.image_url}}with-img{{/if}}" type="${msgItem.content_type}">                                                    {{if msgItem.image_url}}<img src="${msgItem.image_url}">{{/if}} <span class="quickreplyText {{if msgItem.image_url}}with-img{{/if}}">${msgItem.title}</span></span>                                                </div>                                             {{/each}}                                         </div>                                    </div>                                {{/if}}                             </div>                        </li>                     {{/if}}                 </scipt>':"templateAttachment"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         {{each(key, msgItem) msgData.message}}                             {{if msgItem.component && msgItem.component.payload.url}}                                 <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} {{if msgData.icon}}with-icon{{/if}}">                                     {{if msgData.createdOn}}<div class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                                     {{if msgData.icon}}<div class="profile-photo"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                                     <div class="messageBubble">                                        {{if msgItem.component.payload.url}}                                             <div class="msgCmpt botResponseAttachments" fileid="${msgItem.component.payload.url}">                                                 <div class="uploadedFileIcon">                                                     {{if msgItem.component.type == "image"}}                                                         <span class="icon cf-icon icon-photos_active"></span>                                                     {{else msgItem.component.type == "audio"}}                                                        <span class="icon cf-icon icon-files_audio"></span>                                                     {{else msgItem.component.type == "video"}}                                                         <span class="icon cf-icon icon-video_active"></span>                                                     {{else}}                                                         {{if extension[1]=="xlsx" || extension[1]=="xls" || extension[1]=="docx" || extension[1]=="doc" || extension[1]=="pdf" || extension[1]=="ppsx" || extension[1]=="pptx" || extension[1]=="ppt" || extension[1]=="zip" || extension[1]=="rar"}}                                                            <span class="icon cf-icon icon-files_${extension[1]}"></span>                                                         {{else extension[1]}}                                                            <span class="icon cf-icon icon-files_other_doc"></span>                                                         {{/if}}                                                    {{/if}}                                                </div>                                                 <div class="botuploadedFileName">${extractedFileName}</div>                                             </div>                                         {{/if}}                                     </div>                                 </li>                             {{/if}}                         {{/each}}                     {{/if}}                 </scipt>':"carouselTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon">                             {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                             {{if msgData.icon}}<div aria-live="off" class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                             {{if msgData.message[0].component.payload.text}}<div class="messageBubble tableChart">                                <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                            </div>{{/if}}                            <div class="carousel" id="carousel-one-by-one" style="height: 0px;">                                {{each(key, msgItem) msgData.message[0].component.payload.elements}}                                     <div class="slide">                                        {{if msgItem.image_url}}                                             <div class="carouselImageContent" {{if msgItem.default_action && msgItem.default_action.url}}url="${msgItem.default_action.url}"{{/if}} {{if msgItem.default_action && msgItem.default_action.title}}data-value="${msgItem.default_action.title}"{{/if}} {{if msgItem.default_action && msgItem.default_action.type}}type="${msgItem.default_action.type}"{{/if}} {{if msgItem.default_action && msgItem.default_action.payload}} value="${msgItem.default_action.payload}"{{/if}}>                                                 <img alt="image" src="${msgItem.image_url}" onerror="this.onerror=null;this.src=\'../libs/img/no_image.png\';"/>                                             </div>                                         {{/if}}                                         <div class="carouselTitleBox">                                             <p class="carouselTitle">{{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgItem.title, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgItem.title, "user")}} {{/if}}</p>                                             {{if msgItem.subtitle}}<p class="carouselDescription">{{if msgData.type === "bot_response"}} {{html helpers.convertMDtoHTML(msgItem.subtitle, "bot")}} {{else}} {{html helpers.convertMDtoHTML(msgItem.subtitle, "user")}} {{/if}}</p>{{/if}}                                             {{if msgItem.default_action && msgItem.default_action.type === "web_url"}}<div class="listItemPath carouselDefaultAction" type="url" url="${msgItem.default_action.url}">${msgItem.default_action.url}</div>{{/if}}                                             {{if msgItem.buttons}}                                                 {{each(key, msgBtn) msgItem.buttons}}                                                     <div {{if msgBtn.payload}}value="${msgBtn.payload}"{{/if}} {{if msgBtn.url}}url="${msgBtn.url}"{{/if}} class="listItemPath carouselButton" data-value="${msgBtn.value}" type="${msgBtn.type}">                                                        ${msgBtn.title}                                                    </div>                                                 {{/each}}                                             {{/if}}                                         </div>                                    </div>                                {{/each}}                             </div>                        </li>                     {{/if}}                </scipt>':"pieChartTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon piechart">                             {{if msgData.createdOn}}<div class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                             {{if msgData.icon}}<div class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                             {{if msgData.message[0].component.payload.text}}<div class="messageBubble pieChart">                                <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                            </div>{{/if}}                            <div id="d3Pie">                            </div>                            <div class="piechartDiv">                                <div class="lineChartChildDiv" id="piechart${msgData.messageId}"></div>                            </div>                        </li>                     {{/if}}                 </scipt>':"tableChartTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon tablechart">                             {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                             {{if msgData.icon}}<div aria-live="off" class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                             {{if msgData.message[0].component.payload.text}}<div class="messageBubble tableChart">                                <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                            </div>{{/if}}                            <div class="tablechartDiv {{if msgData.message[0].component.payload.table_design && msgData.message[0].component.payload.table_design == "regular"}}regular{{else}}hide{{/if}}">                                <div style="overflow-x:auto; padding: 0 8px;">                                    <table cellspacing="0" cellpadding="0">                                        <tr class="headerTitle">                                            {{each(key, tableHeader) msgData.message[0].component.payload.columns}}                                                 <th {{if tableHeader[1]}}style="text-align:${tableHeader[1]};"{{/if}}>${tableHeader[0]}</th>                                            {{/each}}                                         </tr>                                        {{each(key, tableRow) msgData.message[0].component.payload.elements}}                                             {{if tableRow.Values.length>1}}                                                <tr {{if key > 4}}class="hide"{{/if}}>                                                    {{each(cellkey, cellValue) tableRow.Values}}                                                         <td  {{if cellkey === tableRow.Values.length-1}}colspan="2"{{/if}} class=" {{if key == 0}} addTopBorder {{/if}}" {{if msgData.message[0].component.payload.columns[cellkey][1]}}style="text-align:${msgData.message[0].component.payload.columns[cellkey][1]};" {{/if}} title="${cellValue}">${cellValue}</td>                                                    {{/each}}                                                 </tr>                                            {{/if}}                                        {{/each}}                                     </table>                                </div>                                {{if msgData.message[0].component.payload.elements.length > 5 && msgData.message[0].component.payload.table_design && msgData.message[0].component.payload.table_design == "regular"}}<div class="showMore">Show more</div>{{/if}}                            </div>                             <div class="accordionTable {{if msgData.message[0].component.payload.table_design && msgData.message[0].component.payload.table_design == "regular"}}hide{{else}}responsive{{/if}}">                                {{each(key, tableRow) msgData.message[0].component.payload.elements}}                                     {{if key < 4}}                                        <div class="accordionRow">                                            {{each(cellkey, cellValue) tableRow.Values}}                                                 {{if cellkey < 2}}                                                    <div class="accordionCol">                                                        <div class="colTitle hideSdkEle">${msgData.message[0].component.payload.columns[cellkey][0]}</div>                                                        <div class="colVal">${cellValue}</div>                                                    </div>                                                {{else}}                                                    <div class="accordionCol hideSdkEle">                                                        <div class="colTitle">${msgData.message[0].component.payload.columns[cellkey][0]}</div>                                                        <div class="colVal">${cellValue}</div>                                                    </div>                                                {{/if}}                                            {{/each}}                                             <span class="fa fa-caret-right tableBtn"></span>                                        </div>                                    {{/if}}                                {{/each}}                                 <div class="showMore">Show more</div>                            </div>                        </li>                     {{/if}}                 </scipt>':"miniTableChartTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon tablechart">                             {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                             {{if msgData.icon}}<div aria-live="off" class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                             {{if msgData.message[0].component.payload.text}}<div class="messageBubble tableChart">                                <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                            </div>{{/if}}                            {{each(key, table) msgData.message[0].component.payload.elements}}                                <div class="minitableDiv">                                    <div style="overflow-x:auto; padding: 0 8px;">                                        <table cellspacing="0" cellpadding="0">                                            <tr class="headerTitle">                                                {{each(key, tableHeader) table.primary}}                                                     <th {{if tableHeader[1]}}style="text-align:${tableHeader[1]};" {{/if}}>${tableHeader[0]}</th>                                                {{/each}}                                             </tr>                                            {{each(key, additional) table.additional}}                                                 <tr>                                                    {{each(cellkey, cellValue) additional}}                                                         <td  {{if cellkey === additional.length-1}}colspan="2"{{/if}}  {{if table.primary[cellkey][1]}}style="text-align:${table.primary[cellkey][1]};" {{/if}} title="${cellValue}">${cellValue}</td>                                                    {{/each}}                                                 </tr>                                            {{/each}}                                         </table>                                    </div>                                </div>                            {{/each}}                        </li>                     {{/if}}                 </scipt>':"miniTableHorizontalTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                     <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon tablechart">                         {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                         {{if msgData.icon}}<div aria-live="off" class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                         {{if msgData.message[0].component.payload.text}}<div class="messageBubble tableChart">                            <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                        </div>{{/if}}                        <div class="carousel" id="carousel-one-by-one" style="height: 0px;">                            {{each(key, table) msgData.message[0].component.payload.elements}}                                <div class="slide">                                    <div class="minitableDiv">                                        <div style="overflow-x:auto; padding: 0 8px;">                                            <table cellspacing="0" cellpadding="0">                                                <tr class="headerTitle">                                                    {{each(key, tableHeader) table.primary}}                                                         <th {{if tableHeader[1]}}style="text-align:${tableHeader[1]};" {{/if}}>${tableHeader[0]}</th>                                                    {{/each}}                                                 </tr>                                                {{each(key, additional) table.additional}}                                                     <tr>                                                        {{each(cellkey, cellValue) additional}}                                                             <td  {{if cellkey === additional.length-1}}colspan="2"{{/if}}  {{if table.primary[cellkey][1]}}style="text-align:${table.primary[cellkey][1]};" {{/if}} title="${cellValue}">${cellValue}</td>                                                        {{/each}}                                                     </tr>                                                {{/each}}                                             </table>                                        </div>                                    </div>                                </div>                            {{/each}}                        </div>                    </li>                     {{/if}}                 </scipt>':"barchartTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon barchart">                             {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                             {{if msgData.icon}}<div aria-live="off" class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                             {{if msgData.message[0].component.payload.text}}<div class="messageBubble barchart">                                <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                            </div>{{/if}}                            <div class="barchartDiv">                                <div class="lineChartChildDiv" id="barchart${msgData.messageId}"></div>                            </div>                        </li>                     {{/if}}                 </scipt>':"linechartTemplate"===e?'<script id="chat_message_tmpl" type="text/x-jqury-tmpl">                     {{if msgData.message}}                         <li {{if msgData.type !== "bot_response"}}id="msg_${msgItem.clientMessageId}"{{/if}} class="{{if msgData.type === "bot_response"}}fromOtherUsers{{else}}fromCurrentUser{{/if}} with-icon linechart">                             {{if msgData.createdOn}}<div aria-live="off" class="extra-info">${helpers.formatDate(msgData.createdOn)}</div>{{/if}}                             {{if msgData.icon}}<div aria-live="off" class="profile-photo extraBottom"> <div class="user-account avtar" style="background-image:url(${msgData.icon})"></div> </div> {{/if}}                             {{if msgData.message[0].component.payload.text}}<div class="messageBubble linechart">                                <span>{{html helpers.convertMDtoHTML(msgData.message[0].component.payload.text, "bot")}}</span>                            </div>{{/if}}                            <div class="linechartDiv">                                <div class="lineChartChildDiv" id="linechart${msgData.messageId}"></div>                            </div>                        </li>                     {{/if}}                 </scipt>':'<script id="chat_window_tmpl" type="text/x-jqury-tmpl">                     <div class="kore-chat-window droppable liteTheme-one">                     <div class="kr-wiz-menu-chat defaultTheme-kore">                    </div>\t                        <div class="minimized-title"></div>                         <div class="minimized"><span class="messages"></span></div>                         <div class="kore-chat-header">                             <div id="botHeaderTitle" aria-labelledby="botHeaderTitle" class="header-title" title="${chatTitle}">Chat with CIBIL</div>                             <div class="chat-box-controls">                                 <button class="reload-btn" title="Reconnect"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTNweCIgaGVpZ2h0PSIxNHB4IiB2aWV3Qm94PSIwIDAgMTMgMTQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjMgKDY3Mjk3KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5yZWxvYWQ8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iQXJ0Ym9hcmQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zNTcuMDAwMDAwLCAtMjQxLjAwMDAwMCkiIGZpbGw9IiM4QTk1OUYiIHN0cm9rZT0iIzhBOTU5RiI+CiAgICAgICAgICAgIDxnIGlkPSJyZWxvYWQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDM1OC4wMDAwMDAsIDI0Mi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMC44LDUuMjczNTc2NTggQzEwLjgsMi4zNjU3MTQyIDguMzc3NTg1NzEsMCA1LjQwMDAyMzg3LDAgQzIuNDIyNDYyMDMsMCAwLDIuMzY1NzE0MiAwLDUuMjczNTc2NTggQzAsNS40NDYzMTE0MiAwLjE0MzQwNjM1Myw1LjU4NjM1OTc2IDAuMzIwMjgyOTQyLDUuNTg2MzU5NzYgQzAuNDk3MTU5NTMsNS41ODYzNTk3NiAwLjY0MDU2NTg4Myw1LjQ0NjI4ODEgMC42NDA1NjU4ODMsNS4yNzM1NzY1OCBDMC42NDA1NjU4ODMsMi43MTA2NDc2NSAyLjc3NTY0MjI2LDAuNjI1NTg5NjY4IDUuNCwwLjYyNTU4OTY2OCBDOC4wMjQzNTc3NCwwLjYyNTU4OTY2OCAxMC4xNTk0MzQxLDIuNzEwNjcwOTYgMTAuMTU5NDM0MSw1LjI3MzU3NjU4IEMxMC4xNTk0MzQxLDcuODM2NDU4ODkgOC4wMjQzNTc3NCw5LjkyMTU0MDE4IDUuNCw5LjkyMTU0MDE4IEw0Ljg0NDMyNzI0LDkuOTIxNTQwMTggTDUuNjM4ODc1MzEsOS4wNTI5NzAwMyBDNS43NTY3MzczMyw4LjkyNDE1OTEyIDUuNzQ1MzAyMDYsOC43MjY0MDgxNiA1LjYxMzQwMjYsOC42MTEzMDYgQzUuNDgxNTAzMTMsOC40OTYyMDM4NSA1LjI3ODk4NjcyLDguNTA3Mzk0NjYgNS4xNjExNDg1Nyw4LjYzNjIwNTU2IEw0LjAyNTM1Njg4LDkuODc3ODAyNzYgQzMuODM5NDMyMzUsMTAuMDgxMDU1OSAzLjgzOTQzMjM1LDEwLjM4NzU5MDggNC4wMjUzNTY4OCwxMC41OTA4NDQgTDUuMTYxMTQ4NTcsMTEuODMyNDQxMiBDNS4yMjQ0MzY0NCwxMS45MDE2Mzc3IDUuMzEyMDc0OTgsMTEuOTM2ODQyMSA1LjQwMDExOTM3LDExLjkzNjg0MjEgQzUuNDc2MDYwMDQsMTEuOTM2ODQyMSA1LjU1MjMxMTA2LDExLjkxMDU5MDMgNS42MTM0MDI2LDExLjg1NzM0MDcgQzUuNzQ1MzI1OTQsMTEuNzQyMjM4NiA1Ljc1NjczNzMzLDExLjU0NDQ4NzYgNS42Mzg4NzUzMSwxMS40MTU2NzY3IEw0Ljg0NDMyNzI0LDEwLjU0NzEwNjUgTDUuNCwxMC41NDcxMDY1IEM4LjM3NzU4NTcxLDEwLjU0NzEwNjUgMTAuOCw4LjE4MTM5MjM0IDEwLjgsNS4yNzM1NzY1OCBaIiBpZD0iUGF0aCI+PC9wYXRoPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="></button>                                 <button class="minimize-btn" title="Minimize"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTRweCIgaGVpZ2h0PSIycHgiIHZpZXdCb3g9IjAgMCAxNCAyIiB2ZXJzaW9uPSIxLjEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiPgogICAgPCEtLSBHZW5lcmF0b3I6IFNrZXRjaCA1Mi4zICg2NzI5NykgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+bWluaW1pemU8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iQXJ0Ym9hcmQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zMjYuMDAwMDAwLCAtMjMzLjAwMDAwMCkiIGZpbGw9IiM4QTk1OUYiPgogICAgICAgICAgICA8ZyBpZD0ibWluaW1pemUiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMyNi4wMDAwMDAsIDIzMy4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxwb2x5Z29uIGlkPSJQYXRoIiBwb2ludHM9IjAgMCAxMy45Mzk5OTk2IDAgMTMuOTM5OTk5NiAxLjk5OTk5OTk0IDAgMS45OTk5OTk5NCI+PC9wb2x5Z29uPgogICAgICAgICAgICA8L2c+CiAgICAgICAgPC9nPgogICAgPC9nPgo8L3N2Zz4="></button>                                 <button class="expand-btn" title="Expand"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTRweCIgaGVpZ2h0PSIxNHB4IiB2aWV3Qm94PSIwIDAgMTQgMTQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjMgKDY3Mjk3KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5leHBhbmQ8L3RpdGxlPgogICAgPGRlc2M+Q3JlYXRlZCB3aXRoIFNrZXRjaC48L2Rlc2M+CiAgICA8ZyBpZD0iUGFnZS0xIiBzdHJva2U9Im5vbmUiIHN0cm9rZS13aWR0aD0iMSIgZmlsbD0ibm9uZSIgZmlsbC1ydWxlPSJldmVub2RkIj4KICAgICAgICA8ZyBpZD0iQXJ0Ym9hcmQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0zMDUuMDAwMDAwLCAtMjUyLjAwMDAwMCkiIGZpbGw9IiM4QTk1OUYiIGZpbGwtcnVsZT0ibm9uemVybyI+CiAgICAgICAgICAgIDxnIGlkPSJleHBhbmQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDMwNS4wMDAwMDAsIDI1Mi4wMDAwMDApIj4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xLjg2NjY2NjY3LDkuMzMzMzMzMzMgTDAsOS4zMzMzMzMzMyBMMCwxNCBMNC42NjY2NjY2NywxNCBMNC42NjY2NjY2NywxMi4xMzMzMzMzIEwxLjg2NjY2NjY3LDEyLjEzMzMzMzMgTDEuODY2NjY2NjcsOS4zMzMzMzMzMyBaIE0wLDQuNjY2NjY2NjcgTDEuODY2NjY2NjcsNC42NjY2NjY2NyBMMS44NjY2NjY2NywxLjg2NjY2NjY3IEw0LjY2NjY2NjY3LDEuODY2NjY2NjcgTDQuNjY2NjY2NjcsMCBMMCwwIEwwLDQuNjY2NjY2NjcgWiBNMTIuMTMzMzMzMywxMi4xMzMzMzMzIEw5LjMzMzMzMzMzLDEyLjEzMzMzMzMgTDkuMzMzMzMzMzMsMTQgTDE0LDE0IEwxNCw5LjMzMzMzMzMzIEwxMi4xMzMzMzMzLDkuMzMzMzMzMzMgTDEyLjEzMzMzMzMsMTIuMTMzMzMzMyBaIE05LjMzMzMzMzMzLDAgTDkuMzMzMzMzMzMsMS44NjY2NjY2NyBMMTIuMTMzMzMzMywxLjg2NjY2NjY3IEwxMi4xMzMzMzMzLDQuNjY2NjY2NjcgTDE0LDQuNjY2NjY2NjcgTDE0LDAgTDkuMzMzMzMzMzMsMCBaIiBpZD0iU2hhcGUiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"></button>                                <button class="close-btn" title="Close"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiPz4KPHN2ZyB3aWR0aD0iMTRweCIgaGVpZ2h0PSIxNHB4IiB2aWV3Qm94PSIwIDAgMTQgMTQiIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDUyLjMgKDY3Mjk3KSAtIGh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaCAtLT4KICAgIDx0aXRsZT5jbG9zZTwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiPgogICAgICAgIDxnIGlkPSJBcnRib2FyZCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTM0NC4wMDAwMDAsIC0yMjkuMDAwMDAwKSIgZmlsbD0iIzhBOTU5RiI+CiAgICAgICAgICAgIDxnIGlkPSJjbG9zZSIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMzQ0LjAwMDAwMCwgMjI5LjAwMDAwMCkiPgogICAgICAgICAgICAgICAgPHBvbHlnb24gaWQ9IlNoYXBlIiBwb2ludHM9IjE0IDEuNCAxMi42IDAgNyA1LjYgMS40IDAgMCAxLjQgNS42IDcgMCAxMi42IDEuNCAxNCA3IDguNCAxMi42IDE0IDE0IDEyLjYgOC40IDciPjwvcG9seWdvbj4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+"></button>                             </div>                         </div>                         <div class="kore-chat-header historyLoadingDiv">                             <div class="historyWarningTextDiv displayTable">                                 <span><img class = "loadingHistory" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABEAAAARCAYAAAA7bUf6AAAAAXNSR0IArs4c6QAAAYZJREFUOBGtVLFKA0EQfbMiiERQEgjpRQt/wULB/opIFCuJvb1iKdprbbASDaa4L9DCX7BQ7CVwQcEggph13t7t3RlivMKBsDsz701mZ9+eYNjaNyX0e9saDmCxZJv1mrQ6zxDcayxEqXyOxmo/TzN5B2fXDbxFT7D2VH9rgK3FeV3pM848cTnLirQ6e0q60lw1lx+11bziHD5Oi1tcZVfAkyIYOYRM3GF69gHvr4uwX8sY2AMFVDwIkA3srLcFnAFb9B2I3GJqchNbQTcDJ7uLsIqPz0s91koS6WKmMm+SIfojRL8WIIuF+QdAlBSpks+ZBEkA7gijOkgBumGeR80sMLzG1OcMilgep3wDseWUxyEWsTnzmMKUr51ILw3wForYy2AhhSlfO3FKjGO8xiKWxymfgw1THnXAaxxnzMd68ajQuLcAeE1UnA5+K+R1kgmuS/4/KdY3xbdgB0fe/XMVs49m/Zi4uBPPiN/Qibrj5qJHl12+GU/7WYTRoe+J0xFlMOZ78g1n4achujvX7QAAAABJRU5ErkJggg=="></span>                                 <p class="headerTip warningTip">Loading chat history..</p>                             </div>                         </div>                         <div class="kore-chat-header trainWarningDiv">                             <div class="trainWarningTextDiv displayTable">                                 <span class="exclamation-circle"><i class="fa fa-exclamation-circle" aria-hidden="true"></i></span>                                 <p class="headerTip warningTip">Something went wrong.Please try again later.</p>                             </div>                         </div>                         <div role="region" aria-live="assertive" class="kore-chat-body">                             <div class="errorMsgBlock">                             </div> \t\t\t\t\t\t\t<div class="pinnedBanner">\t\t\t\t\t\t\tPlease do not disclose any personal information with your questions.</div>                            <ul class="chat-container"></ul>                         </div>                         <div class="typingIndicatorContent"><div class="typingIndicator"></div><div class="movingDots"></div></div>                         <div class="kore-chat-footer disableFooter"><div class="footerContainer pos-relative">                         {{if userAgentIE}}                         <div role="textbox" class="chatInputBox inputCursor" aria-label="Message" aria-label="Message" contenteditable="true" placeholder="${botMessages.message}"></div>                         {{else}}                         <div role="textbox" class="chatInputBox" contenteditable="true" placeholder="${botMessages.message}"></div>                         {{/if}}                     <div class="attachment"></div>                     {{if isTTSEnabled}}                         <div class="sdkFooterIcon ttspeakerDiv ttsOff">                             <button class="ttspeaker" title="Talk to speak">                                 <span class="ttsSpeakerEnable"></span>                                 <span class="ttsSpeakerDisable"></span>                                 <span style="display:none;"><audio id="ttspeaker" controls="" autoplay="" name="media"><source src="" type="audio/wav"></audio></span>                            </button>                         </div>                     {{/if}}                     {{if isSpeechEnabled}}                    <div class="sdkFooterIcon microphoneBtn">                         <button class="notRecordingMicrophone" title="Microphone On">                             <i class="microphone"></i>                         </button>                         <button class="recordingMicrophone" title="Microphone Off" >                             <i class="microphone"></i>                             <span class="recordingGif"></span>                         </button>                         <div id="textFromServer"></div>                     </div>                     {{/if}}                    <div class="sdkFooterIcon">                         <input type="file" name="Attachment" class="filety" id="captureAttachmnts">                     </div>                     {{if !(isSendButton)}}<div class="chatSendMsg">Press enter to send</div>{{/if}}                 </div>{{if isSendButton}}<div class="sendBtnCnt"><button class="sendButton disabled" type="button">Send</button></div>{{/if}}</div>                          <div id="myModal" class="modalImagePreview">                              <span class="closeImagePreview">&times;</span>                              <img class="modal-content-imagePreview" id="img01">                              <div id="caption"></div>                        </div>                        <div id="myPreviewModal" class="modalImagePreview">                              <span class="closeElePreview">&times;</span>                              <div class="largePreviewContent"></div>                        </div>                        <div class="kr-wiz-content-chat defaultTheme-kore">                        </div>                    </div>                 <\/script>'},window.onbeforeunload=function(){K&&e(K.config.chatContainer).length>0&&K.destroy()},this.addListener=function(e,t){h||(h={}),e&&e.trim().length>0&&(h[e]||(h[e]=[]),"function"==typeof t&&h[e].push(t))},this.removeListener=function(e){h&&h[e]&&delete h[e]},this.callListener=function(e,t){if(h&&h[e])for(var a=0;a<h[e].length;a++)"function"==typeof h[e][a]&&h[e][a].call(this,t)},this.show=function(t){return!(e("body").find(".kore-chat-window").length>0)&&(t.chatHistory=this.chatHistory,t.handleError=this.showError,t.widgetSDKInstace&&this.addWidgetEvents(t),K=new ae(t),J=new customTemplate(t),this)},this.addWidgetEvents=function(t){if(t){var a=t.widgetSDKInstace;a.events.onPostback=function(t){e(".chatInputBox").text(t.payload),K.sendMessage(e(".chatInputBox"),t.utterance,t)}}},this.setWidgetInstance=function(e){e&&(K.config.widgetSDKInstace=e,this.addWidgetEvents(K.config))},this.destroy=function(){K&&K.destroy&&(h={},K.destroy()),R&&(R.close(),R=null),window.removeEventListener("online",ne),window.removeEventListener("offline",ne)},this.initToken=function(e){I="bearer "+e.accessToken},this.hideError=function(){e(".errorMsgBlock").removeClass("showError")},this.showError=function(t){try{(t=JSON.parse(t)).errors&&t.errors[0]&&(e(".errorMsgBlock").text(t.errors[0].msg),e(".errorMsgBlock").addClass("showError"))}catch(a){e(".errorMsgBlock").text(t),e(".errorMsgBlock").addClass("showError")}},this.botDetails=function(e,t){},this.chatHistory=function(t){if(z){D=!0;var a=window.chatContainerConfig;t&&t[1]&&t[1].messages.length>0?(e(".chat-container").hide(),e(".historyLoadingDiv").addClass("showMsg"),t[1].messages.forEach(function(n,o){setTimeout(function(s){var i=s.filter(function(e){return e.messageId===n.messageId});if(!i.length)try{n.message[0].cInfo.body=JSON.parse(n.message[0].cInfo.body),n.message[0].cInfo.body&&n.message[0].cInfo.body.text&&(n.message[0].cInfo.body=n.message[0].cInfo.body.text),n.message[0].component=n.message[0].cInfo.body,"dropdown_template"===n.message[0].component.payload.template_type&&(n.message[0].component.payload.fromHistory=!0,n.message[0].component.selectedValue=t[1].messages[o+1].message[0].cInfo.body),"multi_select"===n.message[0].component.payload.template_type&&(n.message[0].component.payload.fromHistory=!0),n.message[0].component&&n.message[0].component.payload&&(n.message[0].component.payload.videoUrl||n.message[0].component.payload.audioUrl)&&(n.message[0].cInfo.body=""),a.renderMessage(n)}catch(e){a.renderMessage(n)}o===t[1].messages.length-1&&setTimeout(function(t){e(".chat-container").show(),e(".chat-container").animate({scrollTop:e(".chat-container").prop("scrollHeight")},2500),e(".historyLoadingDiv").removeClass("showMsg"),e(".chat-container").append("<div class='endChatContainer'><span class='endChatContainerText'>End of chat history</span></div>"),t.length?t.forEach(function(n,o){a.renderMessage(n),t.length-1===o&&(t=[],setTimeout(function(){e(".chatInputBox").focus(),e(".disableFooter").removeClass("disableFooter"),D=!1}))}):setTimeout(function(){e(".chatInputBox").focus(),e(".disableFooter").removeClass("disableFooter"),D=!1})},500,s)},100*o,M)})):setTimeout(function(){e(".chatInputBox").focus(),e(".disableFooter").removeClass("disableFooter"),D=!1})}};var ie,le,re,ce,de,me="",pe=!1,ge=null,ue="";setTimeout(function(){B&&(window.initGapi?initGapi():console.warn("Please uncomment Google Speech files('speech/app.js','speech/key.js' and 'client_api.js' in index.html"))},2e3),"webkitSpeechRecognition"in window&&(ie=window.chrome,le=window.navigator,re=le.vendor,ce=le.userAgent.indexOf("OPR")>-1,de=le.userAgent.indexOf("Edge")>-1,le.userAgent.match("CriOS")||null!=ie&&"Google Inc."===re&&!1===ce&&!1===de)&&(ge=new window.webkitSpeechRecognition,me="",ge.continuous=!0,ge.interimResults=!0,ge.onstart=function(){ue="",pe=!0,e(".recordingMicrophone").css("display","block"),e(".notRecordingMicrophone").css("display","none")},ge.onerror=function(t){console.log(t.error),e(".recordingMicrophone").trigger("click"),e(".recordingMicrophone").css("display","none"),e(".notRecordingMicrophone").css("display","block")},ge.onend=function(){pe=!1,e(".recordingMicrophone").trigger("click"),e(".recordingMicrophone").css("display","none"),e(".notRecordingMicrophone").css("display","block")},ge.onresult=function(t){me="";for(var a,n="",o=t.resultIndex;o<t.results.length;++o)t.results[o].isFinal?me+=t.results[o][0].transcript:n+=t.results[o][0].transcript;me=ve(me=(a=me).replace(a.substr(0,1),function(e){return e.toUpperCase()})),n=ve(n),""!==me&&(ue+=me),pe&&(e(".chatInputBox").html(ue+""+n),e(".sendButton").removeClass("disabled")),setTimeout(function(){oe(document.getElementsByClassName("chatInputBox")),document.getElementsByClassName("chatInputBox")[0].scrollTop=document.getElementsByClassName("chatInputBox")[0].scrollHeight},350)});var fe=/\n\n/g,he=/\n/g;function ve(e){return e.replace(fe,"<p></p>").replace(he,"<br>")}function ye(){x||(_.getUserMedia||(_.getUserMedia=_.getUserMedia||_.webkitGetUserMedia||_.mozGetUserMedia||_.msGetUserMedia),_.getUserMedia?(x=!0,_.getUserMedia({audio:!0},Ie,function(e){x=!1,alert("Please enable the microphone permission for this page")})):(x=!1,alert("getUserMedia is not supported in this browser.")))}function be(){if(_.getUserMedia){if(!l)return x=!1,void console.error("Recorder undefined");r&&Me();try{r=function(){window.ENABLE_MICROPHONE=!0,window.SPEECH_SERVER_SOCKET_URL=A;var t=window.SPEECH_SERVER_SOCKET_URL,a=C;window.WebSocket=window.WebSocket||window.MozWebSocket;var n=new WebSocket(t+"&"+E+"&email="+a);return n.onopen=function(t){console.log("User connected"),l.record(),e(".recordingMicrophone").css("display","block"),e(".notRecordingMicrophone").css("display","none"),console.log("recording..."),ue="",c=setInterval(function(){l.export16kMono(function(e){De(e),l.clear()},"audio/x-raw")},O)},n.onmessage=function(t){var a=t.data,n="";if(a instanceof Object&&!(a instanceof Blob))console.log("Got object that is not a blob");else if(a instanceof Blob)console.log("Got Blob");else{var o=JSON.parse(a);w&&0===o.status?(n=o.result.hypotheses[0].transcript,o.result.final&&(ue+=o.result.hypotheses[0].transcript+" ",n=""),console.log("Interm: ",n),console.log("final: ",ue),e(".chatInputBox").html(ue+""+n),setTimeout(function(){oe(document.getElementsByClassName("chatInputBox")),document.getElementsByClassName("chatInputBox")[0].scrollTop=document.getElementsByClassName("chatInputBox")[0].scrollHeight},350)):console.log("Server error : ",o.status)}},n.onclose=function(t){""!==e(".chatInputBox").text()&&Z&&window.chatContainerConfig.sendMessage(e(".chatInputBox")),x=!1,console.log("Server is closed"),console.log(t),Me()},n.onerror=function(e){console.log("Error : ",e)},n}()}catch(e){x=!1,console.log(e),console.error("Web socket not supported in the browser")}}}function Ie(t){if(w=!0,s=t,!d){var a=window.AudioContext||window.webkitAudioContext;d=new a}i=d.createMediaStreamSource(s),window.userSpeechAnalyser=d.createAnalyser(),i.connect(window.userSpeechAnalyser),console.log("Mediastream created"),r&&(r.close(),r=null),l&&(l.stop(),l.clear(),l=null),l=new Recorder(i,{workerPath:S}),console.log("Recorder Initialized"),B?l&&(l.record(),e(".recordingMicrophone").css("display","block"),e(".notRecordingMicrophone").css("display","none"),console.log("recording..."),c=setInterval(function(){l.export16kMono(function(e){console.log(new Date),B?sendBlobToSpeech(e,"LINEAR16",16e3):De(e),l.clear()},"audio/x-raw")},1e3)):be(),setTimeout(function(){oe(document.getElementsByClassName("chatInputBox"))},600)}function Me(){if(clearInterval(c),x=!1,e(".recordingMicrophone")&&e(".recordingMicrophone").css("display","none"),e(".notRecordingMicrophone")&&e(".notRecordingMicrophone").css("display","block"),null!==s&&s&&s.getTracks()[0].enabled){var t=s.getTracks()[0];t.stop()}r&&(r.close(),r=null),l&&(l.stop(),l.clear()),A=""}function De(e){if(r){var t=r.readyState;1===t?e instanceof Blob?e.size>0&&r.send(e):(console.log(e),r.send(e)):(x=!1,console.error("Web Socket readyState != 1: ",t,"failed to send :"+e.type+", "+e.size),Me())}else x=!1,console.error("No web socket connection: failed to send: ",e)}function Ce(){if(""!==e(".chatInputBox").text()&&Z){var t=window.chatContainerConfig;t.sendMessage(e(".chatInputBox"))}clearInterval(c),e(".recordingMicrophone").css("display","none"),e(".notRecordingMicrophone").css("display","block"),l?(l.stop(),w=!1,console.log("stopped recording.."),setTimeout(function(){r&&(r.close(),r=null)},1e3),l.export16kMono(function(e){De(e),l.clear(),r&&r.close();var t=s.getTracks()[0];t.stop(),l.destroy(),x=!1},"audio/x-raw")):console.error("Recorder undefined"),pe&&(ge.stop(),pe=!1)}function we(e){if("speechSynthesis"in window){window.speechSynthesis.cancel();var t=new SpeechSynthesisUtterance;t.text=e,window.speechSynthesis.speak(t)}else console.warn("KORE:Your browser doesn't support TTS(Speech Synthesiser)")}function xe(){H&&(H.close(),H=null)}function ke(e,t,a){var n,o={};if(t&&t.size&&t.size>Q.file.limit.size)alert(Q.file.limit.msg);else if(t&&a&&(t.name=a),t&&(t.name||a)){var s=a||t.name,i=s.split(".").pop().toLowerCase();if(o.name=s,o.mediaName=(n||"xxxxyx").replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}),o.fileType=s.split(".").pop().toLowerCase(),Q.image.indexOf(o.fileType)>-1?(o.type="image",o.uploadFn="acceptFileRecording"):Q.video.indexOf(o.fileType)>-1?(o.type="video",o.uploadFn="acceptVideoRecording"):Q.audio.indexOf(o.fileType)>-1?(o.type="audio",o.uploadFn="acceptFile"):(o.type="attachment",o.componentSize=t.size,o.uploadFn="acceptFile"),F&&-1!==F.indexOf(i))if("audio"===o.type||"video"===o.type){var l=new FileReader;l.onload=function(a){var n=new Blob([a.target.result],{type:t.type}),s=(URL||webkitURL).createObjectURL(n),i=document.createElement(o.type);i.preload="metadata",0===i.readyState?(i.addEventListener("loadedmetadata",function(a){Math.round(a.target.duration),"audio"===o.type&&((URL||webkitURL).revokeObjectURL(s),Le(e,t,o))}),"video"===o.type&&i.addEventListener("loadeddata",function(a){o.resulttype=Te(i),(URL||webkitURL).revokeObjectURL(s),Le(e,t,o)}),i.src=s):((URL||webkitURL).revokeObjectURL(s),Le(e,t,o))},l.readAsArrayBuffer(t)}else if(-1!==t.type.indexOf("image")){var r=new FileReader;r.onload=function(a){var n=new Blob([a.target.result],{type:t.type}),s=(URL||webkitURL).createObjectURL(n),i=new Image;i.src=s,i.onload=function(){o.resulttype=Te(i),Le(e,t,o)}},r.readAsArrayBuffer(t)}else Le(e,t,o);else alert("SDK not supported this type of file")}}function Te(e){var t=document.createElement("canvas");t.height=180,t.width=320;var a=t.getContext("2d");a.drawImage(e,0,0,t.width,t.height);var n=t.toDataURL();return n}function Ae(t,a,n){var o,s,i,l,r=Ne(n);if(r.chunkUpload=a.size>G.CHUNK_SIZE,r.chunkSize=G.CHUNK_SIZE,r.file=a,r.chunkUpload)(l={}).meta={thumbNail:(s=n).resulttype?s.resulttype:void 0},l.values={componentId:s.mediaName,componentType:s.type,componentFileId:i,componentData:{filename:s.name}},s.componentSize&&(l.values.componentSize=s.componentSize),Ee(0,l),o=e(".chatInputBox"),ze(n,o),o.uploader(r);else{var c=new FileReader;c.onloadend=function(t){if(t.target.readyState===FileReader.DONE){var a=c.result.replace(/^.*;base64,/,""),s=(c.result,a);n.resulttype=s,function(t,a,n){var o=Ne(a),s=a.resulttype;Se(0,a),o.data[o.fieldName]={fileName:a.name,data:s,type:"image/png"},o.data.thumbnail={fileName:a.name+"_thumb",data:s,type:"image/png"},n=e(".chatInputBox"),ze(a,n),n.uploader(o)}(0,n,o)}},c.readAsDataURL(a)}}function Le(t,a,s){var i=b||I;e.ajax({type:"POST",url:n+"1.1/attachment/file/token",dataType:"json",headers:{Authorization:i},success:function(e){o=e.fileToken,Ae(t,a,s)},error:function(t){K.config.botOptions._reconnecting=!0,_self.showError("Failed to upload file.Please try again"),t.responseJSON&&t.responseJSON.errors&&t.responseJSON.errors.length&&"401"===t.responseJSON.errors[0].httpStatus&&(setTimeout(function(){_self.hideError()},5e3),e(".kore-chat-window .reload-btn").trigger("click")),console.log("Oops, something went horribly wrong")}})}function Ne(e){return G.UPLOAD={FILE_ENDPOINT:n+"1.1/attachment/file",FILE_TOKEN_ENDPOINT:n+"1.1/attachment/file/token",FILE_CHUNK_ENDPOINT:n+"1.1/attachment/file/:fileID/chunk"},_accessToke="bearer "+a,_uploadConfg={},_uploadConfg.url=G.UPLOAD.FILE_ENDPOINT.replace(":fileID",o),_uploadConfg.tokenUrl=G.UPLOAD.FILE_TOKEN_ENDPOINT,_uploadConfg.chunkUrl=G.UPLOAD.FILE_CHUNK_ENDPOINT.replace(":fileID",o),_uploadConfg.fieldName="file",_uploadConfg.data={fileExtension:e.fileType,fileContext:"workflows",thumbnailUpload:!1,filename:e.name},_uploadConfg.headers={Authorization:_accessToke},_uploadConfg}function ze(t,a){var n=this;(a=a||n.ele).on("success.ke.uploader",function(a){!function(t,a,n){var o=a.params;if(!o||!o.fileId)return alert("Failed to upload content. Try again"),W={},e(".attachment").html(""),e(".sendButton").addClass("disabled"),void(y=0);if(n.mediaName){var s=o.fileId;Se(0,n,s)}}(0,a,t)}),a.on("error.ke.uploader",_e)}function _e(e,t,a){var n=e;_recfileLisnr.onError({code:"UPLOAD_FAILED"}),n.removeCmpt(a)}function Ee(t,a){var n,o;n||((n=e("<div/>").attr({class:"msgCmpt "+a.values.componentType+" "+a.values.componentId})).data("value",a.values),a.values.componentFileId||"contact"===a.values.componentType||"location"===a.values.componentType||"filelink"===a.values.componentType||"alert"===a.values.componentType||"email"===a.values.componentType||n.append('<div class="upldIndc"></div>'),"attachment"===a.values.componentType&&("xls"===(o=a.values.componentDescription?a.values.componentDescription.split(".").pop().toLowerCase():a.values.componentData.filename.split(".").pop().toLowerCase())||"xlsx"===o?(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_excel"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")):"docx"===o||"doc"===o?(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_word"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")):"pdf"===o?(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_pdf"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")):"ppsx"===o||"pptx"===o||"ppt"===o?(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_ppt"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")):"zip"===o||"rar"===o?(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_zip"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")):(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_other_doc"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>"))),"image"===a.values.componentType&&(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-photos_active"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")),"audio"===a.values.componentType&&(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-files_audio"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>")),"video"===a.values.componentType&&(n.append('<div class="uploadedFileIcon"><span class="icon cf-icon icon-video_active"></span></div>'),n.append('<div class="uploadedFileName">'+a.values.componentData.filename+"</div>"))),n.append('<div class="removeAttachment"><span>&times;</span></div>'),e(".footerContainer").find(".attachment").html(n),e(".chatInputBox").focus(),W.fileName=a.values.componentData.filename,W.fileType=a.values.componentType,e(".sendButton").removeClass("disabled")}function Se(e,t,a){var n={};n.meta={thumbNail:t.resulttype},n.values={componentId:t.mediaName,componentType:t.type,componentFileId:a,componentData:{filename:t.name}},Ee(0,n)}function Oe(){this.boundary="--------MultipartData"+Math.random(),this._fields=[]}function je(e,t){this.options=t,this.$element=e,this.options.chunkUpload?function(e){var t=e,a=Re();if(a.addEventListener("error",function(e){Ue(t,e)},!1),a.addEventListener("load",function(e){200===e.target.status?(t.messageToken=JSON.parse(e.target.response).fileToken,t.totalChunks=Math.floor(t.options.file.size/t.options.chunkSize)+1,t.currChunk=0,t.options.chunkUrl=t.options.chunkUrl.replace(":token",t.messageToken),t.$element.parent().length&&$e(t)):Ue(t,e)},!1),a.withCredentials=!1,a.open("POST",e.options.tokenUrl),e.options.headers)for(var n in e.options.headers)a.setRequestHeader(n,e.options.headers[n]);a.send()}(this):Ye(this)}e(window).on("beforeunload",function(){Me()}),function(){if(!R){if(!window.AudioContext){if(!window.webkitAudioContext)return void console.error("Your browser does not support any AudioContext and cannot play back this audio.");window.AudioContext=window.webkitAudioContext}R=new AudioContext}}(),Oe.prototype.append=function(e,t){this._fields.push([e,t])},Oe.prototype.toString=function(){var e=this.boundary,t="";return this._fields.forEach(function(a){if(t+="--"+e+"\r\n",a[1].data){var n=a[1];n.fileName?t+='Content-Disposition: form-data; name="'+a[0]+'"; filename="'+n.fileName+'"':t+='Content-Disposition: form-data; name="'+a[0]+'"',t+="\r\n",n.type&&(t+="Content-Type: UTF-8; charset=ISO-8859-1\r\n"),t+="Content-Transfer-Encoding: base64\r\n",t+="\r\n"+n.data+"\r\n"}else t+='Content-Disposition: form-data; name="'+a[0]+'";\r\n\r\n',t+=a[1]+"\r\n"}),t+="--"+e+"--"};var Be=je.prototype;function Re(e){return new V.net.HttpRequest}function He(t,a){e(".upldIndc").is(":visible")&&(t.events.success.params=e.parseJSON(a.target.response),W.fileId=t.events.success.params.fileId,e(".sendButton").removeClass("disabled"),e(".kore-chat-window").addClass("kore-chat-attachment"),e(".chat-container").scrollTop(e(".chat-container").prop("scrollHeight")),y=1,e(".upldIndc").remove(),t.$element.trigger(t.events.success))}function Ue(e,t){e.events.error.params=t,e.$element.trigger(e.events.error)}function Pe(e){var t=e,a=Re(),n=new Oe;if(a.addEventListener("load",function(e){if(200===e.target.status){if(t.currChunk++,!t.$element.parent().length)return;t.currChunk===t.totalChunks?function(e){var t=e,a=Re(),n=new Oe;if(a.addEventListener("load",function(e){200===e.target.status?t.$element.parent().length&&He(t,e):Ue(t,e)},!1),a.addEventListener("error",function(e){Ue(t,e)},!1),a.withCredentials=!1,a.open("PUT",e.options.chunkUrl.replace(/\/chunk/,"")),e.options.headers)for(var o in e.options.headers)a.setRequestHeader(o,e.options.headers[o]);if(n.append("totalChunks",t.totalChunks),n.append("messageToken",t.messageToken),e.options.data)for(var s in e.options.data)n.append(s,e.options.data[s]);a.setRequestHeader("Content-Type","multipart/form-data; boundary="+n.boundary),a.send(n.toString())}(t):$e(t)}else Ue(t,e)},!1),a.addEventListener("error",function(e){Ue(t,e)},!1),a.withCredentials=!1,a.open("POST",e.options.chunkUrl),e.options.headers)for(var o in e.options.headers)a.setRequestHeader(o,e.options.headers[o]);n.append("chunkNo",t.currChunk),n.append("messageToken",t.messageToken),n.append("chunk",{data:t.chunk,fileName:t.options.file.name}),a.setRequestHeader("Content-Type","multipart/form-data; boundary="+n.boundary),a.send(n.toString())}function $e(e){var t=e,a=t.options.file,n=t.options.chunkSize*t.currChunk,o=t.currChunk===t.totalChunks-1?a.size:(t.currChunk+1)*t.options.chunkSize,s=new FileReader,i=a.slice(n,o);s.onloadend=function(e){e.target.readyState===FileReader.DONE&&t.$element.parent().length?(t.chunk=e.target.result,t.chunk=t.chunk.replace(/data:;base64,/,""),t.currChunk<t.totalChunks&&t.$element.parent().length&&Pe(t)):Ue(t,e)},s.readAsDataURL(i)}function Ye(e){var t=e;if(_conc=Re(),_mdat=new Oe,_conc.upload&&_conc.upload.addEventListener&&_conc.upload.addEventListener("progress",function(e){},!1),_conc.addEventListener("load",function(e){t.$element.parent().length&&He(t,e)},!1),_conc.addEventListener("error",function(e){Ue(t,e)},!1),_conc.withCredentials=!1,_conc.open("POST",e.options.url),e.options.headers)for(var a in e.options.headers)_conc.setRequestHeader(a,e.options.headers[a]);if(e.options.data)for(var n in e.options.data)_mdat.append(n,e.options.data[n]);_conc.setRequestHeader("Content-Type","multipart/form-data; boundary="+_mdat.boundary),_conc.send(_mdat.toString())}function Ze(){var t=document.getElementById("myPreviewModal");e(".largePreviewContent").empty(),e(".largePreviewContent").addClass("addheight"),e(".largePreviewContent").html("<div class='chartContainerDiv'></div>"),t.style.display="block";var a=document.getElementsByClassName("closeElePreview")[0];a.onclick=function(){t.style.display="none",e(".largePreviewContent").removeClass("addheight")}}function Ge(){e(".piechartDiv,.barchartDiv, .linechartDiv").click(function(t){for(var a=t.currentTarget.firstElementChild.getAttribute("id"),n=null,o=null,s=null,i=0;i<q.length;i++)if(q[i].id==a){o=jQuery.extend({},q[i]),Ze();break}if("d3"===graphLibGlob){if(Ze(),void 0===o.data.message[0].component.payload.pie_type&&(o.data.message[0].component.payload.pie_type="regular"),"linechart"!==o.data.message[0].component.payload.template_type&&"piechart"!==o.data.message[0].component.payload.template_type){var l={outerWidth:650,outerHeight:460,innerWidth:450,innerHeight:350,legendRectSize:15,legendSpacing:4};e(".chartContainerDiv").html(""),"barchart"===o.data.message[0].component.payload.template_type&&"vertical"===o.data.message[0].component.payload.direction&&"barchart"===o.type?(l.innerWidth=500,KoreGraphAdapter.drawD3barChart(o.data,l,".chartContainerDiv",12)):"barchart"===o.data.message[0].component.payload.template_type&&"horizontal"===o.data.message[0].component.payload.direction&&"stackedBarchart"===o.type?KoreGraphAdapter.drawD3barStackedChart(o.data,l,".chartContainerDiv",12):"barchart"===o.data.message[0].component.payload.template_type&&"vertical"===o.data.message[0].component.payload.direction&&"stackedBarchart"===o.type?(l.innerWidth=550,KoreGraphAdapter.drawD3barVerticalStackedChart(o.data,l,".chartContainerDiv",12)):"barchart"===o.data.message[0].component.payload.template_type&&"horizontal"===o.data.message[0].component.payload.direction&&"barchart"===o.type&&(l.outerWidth=650,l.outerHeight=350,l.innerWidth=450,l.innerHeight=310,KoreGraphAdapter.drawD3barHorizontalbarChart(o.data,l,".chartContainerDiv",12))}else if("linechart"===o.data.message[0].component.payload.template_type){var l={outerWidth:650,outerHeight:450,innerWidth:480,innerHeight:350,legendRectSize:15,legendSpacing:4};e(".chartContainerDiv").html(""),KoreGraphAdapter.drawD3lineChartV2(o.data,l,".chartContainerDiv",12)}else if(o.data.message[0].component.payload.pie_type){var l={width:600,height:400,legendRectSize:15,legendSpacing:4};e("chartContainerDiv").html(""),"regular"===o.data.message[0].component.payload.pie_type?KoreGraphAdapter.drawD3Pie(o.data,l,".chartContainerDiv",16):"donut"===o.data.message[0].component.payload.pie_type?KoreGraphAdapter.drawD3PieDonut(o.data,l,".chartContainerDiv",16,"donut"):"donut_legend"===o.data.message[0].component.payload.pie_type&&(e("chartContainerDiv").html(""),KoreGraphAdapter.drawD3PieDonut(o.data,l,".chartContainerDiv",16,"donut_legend"))}}else if("google"===graphLibGlob){if("piechart"===o.type){function r(){s=document.getElementsByClassName("chartContainerDiv"),n=new google.visualization.PieChart(s[0])}google.charts.load("current",{packages:["corechart"]}),google.charts.setOnLoadCallback(r)}else if("linechart"===o.type){function r(){s=document.getElementsByClassName("chartContainerDiv"),n=new google.visualization.LineChart(s[0])}google.charts.load("current",{packages:["corechart","line"]}),google.charts.setOnLoadCallback(r)}else if("barchart"===o.type){function r(){s=document.getElementsByClassName("chartContainerDiv"),n="vertical"===o.direction?new google.visualization.ColumnChart(s[0]):new google.visualization.BarChart(s[0])}google.charts.load("current",{packages:["corechart","bar"]}),google.charts.setOnLoadCallback(r)}setTimeout(function(){o.options.chartArea={height:"85%",width:"85%"},google.visualization.events.addListener(n,"ready",function(){setTimeout(function(){e(".largePreviewContent .chartContainerDiv").css("height","91%")})}),n.draw(o.data,o.options)},200)}})}Be.events={error:e.Event("error.ke.uploader"),progressChange:e.Event("progress.ke.uploader"),success:e.Event("success.ke.uploader")};var We=e.fn.uploader;return e.fn.uploader=function(t){var a=Array.prototype.slice.call(arguments,1);return this.each(function(){var n,o,s=e(this),i="";return options="object"==typeof t&&t,i?t&&("string"==typeof t&&i[t]?i[t].apply(i,a):options&&Ye((n=i,o=options,n.options=o,n))):s.data("ke.uploader",i=new je(s,options)),t&&i[t]&&i[t].apply(i,a)})},e.fn.uploader.Constructor=je,e.fn.uploader.noConflict=function(){return e.fn.uploader=We,this},V.net.HttpRequest=function(){var e=function(){var e=!1;return(e=new XMLHttpRequest)?e:"undefined"!=typeof XDomainRequest?new XDomainRequest:e}();if(!e)throw"Unsupported HTTP Connection";try{e.withCredentials=!0}catch(e){}return e.onreadystatechange=function(){return e.onReadyStateChange&&e.onReadyStateChange.call(e)},e},{initToken:initToken,addListener:addListener,removeListener:removeListener,show:show,destroy:destroy,showError:showError,botDetails:botDetails,chatHistory:chatHistory,addWidgetEvents:addWidgetEvents,setWidgetInstance:setWidgetInstance}}(window&&window.KoreSDK&&window.KoreSDK.dependencies&&window.KoreSDK.dependencies.jQuery?window.KoreSDK.dependencies.jQuery:window.jQuery)};